(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[27],{25701:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/d/files/[id]",function(){return t(79822)}])},7135:function(e,n,t){"use strict";t.d(n,{BR:function(){return i},kR:function(){return a}});var r=t(88767),u=t(40782),o=t(40874),i=function(e,n){return(0,r.useQuery)("fetch-files",o.uB,{onSuccess:function(n){e(n)},onError:function(e){u.Am.error("Unable to fetch files. Please try again."),console.log("Unable to fetch files. Error: ",e),n()}})},a=function(e,n){var t=(0,r.useQueryClient)();return(0,r.useMutation)(o.cT,{onSuccess:function(){e(),t.invalidateQueries("fetch-files")},onError:function(e){console.log("Error uploading file: ",e),n()}})}},79822:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return h}});var r=t(35666),u=t.n(r),o=t(85893),i=t(67294),a=t(60758),c=t(11163),s=t(40782),l=t(30653),f=t(93162),d=t(7135),p=t(40874);function v(e,n,t,r,u,o,i){try{var a=e[o](i),c=a.value}catch(s){return void t(s)}a.done?n(c):Promise.resolve(c).then(r,u)}function h(){var e=(0,c.useRouter)(),n=(0,i.useRef)(),t=(0,i.useState)(),r=t[0],h=t[1],w=(0,i.useState)(),y=w[0],m=w[1],x=(0,i.useState)(),b=x[0],P=x[1],E=(0,i.useState)(!1),g=E[0],k=E[1],_=e.query.id,A=(0,d.BR)((function(e){var n,t=null===e||void 0===e?void 0:e.data.files.find((function(e){return e.split("/")[2]===_}));t&&(t=t.split("/")[2],(0,p._t)(t).then((n=u().mark((function e(n){var r,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=atob(n.data.data),e.next=3,(0,p.oy)(r,t);case 3:o=e.sent,console.log(o),o&&h(o);case 6:case"end":return e.stop()}}),e)})),function(){var e=this,t=arguments;return new Promise((function(r,u){var o=n.apply(e,t);function i(e){v(o,r,u,i,a,"next",e)}function a(e){v(o,r,u,i,a,"throw",e)}i(void 0)}))})))})).data,R=(0,i.useCallback)((function(e){var t=URL.createObjectURL(e);n.current.src=t,n.current.play()}),[]),T=(0,i.useCallback)((function(e){var n=new FileReader;n.readAsText(e),n.onloadend=function(){m(n.result)}}),[]),C=(0,i.useCallback)((function(e){var n=new FileReader;n.readAsText(e),n.onloadend=function(){P(n.result)}}),[]);return(0,i.useEffect)((function(){if(_&&A&&r){if(/video\/*/.test(r.type))return void R(r);"text/html"===r.type?T(r):"text/plain"===r.type?C(r):(k(!0),s.Am.error("Unable to process file type. Type is currently unsupported"))}}),[_,R,A,T,C,r]),(0,o.jsxs)(a.Z,{currentPage:"Files",hideNav:!1,children:[r&&(0,o.jsx)("button",{onClick:function(){return(0,f.saveAs)(r)},children:"Download"}),(0,o.jsx)("video",{ref:n,loop:!0}),y&&(0,o.jsx)("div",{children:(0,l.ZP)(y.replace("<!DOCTYPE html><html>","").replace("</html>",""))}),b&&(0,o.jsx)("div",{children:b}),g&&r&&(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("p",{children:"Unable to render this file for viewing. Would you like to download it instead and view locally?"})})]})}},40874:function(e,n,t){"use strict";t.d(n,{uB:function(){return f},cT:function(){return d},_t:function(){return p},oy:function(){return v}});var r=t(35666),u=t.n(r),o=t(49695),i=t(21245),a=t(47193),c=t(48764).Buffer;function s(e,n,t,r,u,o,i){try{var a=e[o](i),c=a.value}catch(s){return void t(s)}a.done?n(c):Promise.resolve(c).then(r,u)}var l,f=function(){return(0,o.W)({url:"/v1/ipfs/list",method:"get",headers:{"Grpc-Metadata-X-API-KEY":"".concat((0,a.P)())}})},d=function(e){var n=new window.FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){var t=btoa(c(n.result)),r={name:e.name,data:t,updatable:!1};return(0,o.W)({url:"/v1/ipfs/add",method:"post",data:r,headers:{"Grpc-Metadata-X-API-KEY":"".concat((0,a.P)())}})}},p=function(e){return(0,o.W)({url:"/v1/ipfs/".concat(e),method:"get",headers:{"Grpc-Metadata-X-API-KEY":"".concat((0,a.P)())}})},v=(l=u().mark((function e(n,t){var r,o,a,c,s,l,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.substring(0,20).includes("<!DOCTYPE html>")){e.next=3;break}return r=new File([n],t,{type:"text/html"}),e.abrupt("return",r);case 3:for(o=n.split(","),a=new Uint8Array(o.length),c=0;c<o.length;c++)a[c]=o[c];return e.next=8,(0,i.pM)(a);case 8:if(!(s=e.sent)){e.next=13;break}return console.log("FILETYPE: ",s),l=new File([a],t,{type:s?s.mime:""}),e.abrupt("return",l);case 13:return f=new File([n],t,{type:"text/plain"}),e.abrupt("return",f);case 15:case"end":return e.stop()}}),e)})),function(){var e=this,n=arguments;return new Promise((function(t,r){var u=l.apply(e,n);function o(e){s(u,t,r,o,i,"next",e)}function i(e){s(u,t,r,o,i,"throw",e)}o(void 0)}))})},50247:function(){}},function(e){e.O(0,[774,445,13,270,905,245,653,758,888,179],(function(){return n=25701,e(e.s=n);var n}));var n=e.O();_N_E=n}]);