(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[843],{72848:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/d/chat",function(){return n(41436)}])},93107:function(e,t,n){"use strict";var s=n(85893),a=n(69641),r=n(36388),i=n(67294),l=n(6218),o=n(85528),c=n(14887),d=n(11163),u=n(43101),m=n(91131),f=n(18426),x=n(63750),h=n(44156),v=n(40782),g=n(96486),p=n.n(g);function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],s=!0,a=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(s=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);s=!0);}catch(o){a=!0,r=o}finally{try{s||null==l.return||l.return()}finally{if(a)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function j(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}t.Z=function(){var e=(0,l.ff)().data,t=(0,d.useRouter)(),n=y((0,m.KO)(u.w5),2)[1],g=(0,i.useState)(),b=g[0],w=g[1],N=(0,i.useState)(!1),C=N[0],k=N[1],O=(0,h.r)().data,S=y((0,m.KO)(u.PF),2)[1];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.Z,{open:C,setOpen:k,selectedContact:b}),(0,s.jsx)("ul",{role:"list",className:"relative divide-y divide-gray-200",children:p().orderBy(null===e||void 0===e?void 0:e.data.contacts,(function(e){return e.name.toLowerCase()}),["asc"]).map((function(e,i){return(0,s.jsx)("li",{children:(0,s.jsxs)("div",{className:"px-6 py-2 flex items-center space-x-3 hover:bg-gray-50",children:[(0,s.jsx)(o.Z,{contact:e,className:"h-10 w-10"}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,s.jsx)(c.Z,{contact:e,className:"h-4 w-4"})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{type:"button",className:"inline-flex items-center border border-1 border-gray-300 rounded-full p-1 text-gray-400",onClick:function(){return function(e){n(e),t.push("/d/chat")}(e)},children:(0,s.jsx)(a.Z,{className:"h-5 w-5","aria-hidden":"true"})}),(0,s.jsx)("button",{type:"button",className:"inline-flex items-center border border-1 border-gray-300 rounded-full p-1 text-gray-400",onClick:function(){return function(e){(null===O||void 0===O?void 0:O.data.lightningConfig.listening)?(w(e),k(!0)):v.Am.info("Connect to a lightning node to use this action.")}(e)},children:(0,s.jsx)(x.rrH,{className:"h-5 w-5","aria-hidden":"true"})}),(0,s.jsx)("button",{type:"button",className:"inline-flex items-center border border-1 border-gray-300 rounded-full p-1 text-gray-400",onClick:function(){return function(e){S((function(t){return j(t).concat([e])})),t.push("/d/meeting")}(e)},children:(0,s.jsx)(r.Z,{className:"h-5 w-5","aria-hidden":"true"})})]})]})]})},i)}))})]})}},51079:function(e,t,n){"use strict";var s=n(85893),a=n(67294),r=n(42633);t.Z=function(e){var t=e.setFile,n=e.disabled,i=(0,a.useRef)(null);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{type:"button",onClick:function(e){i.current.click()},children:(0,s.jsx)(r.Z,{className:"h-10 w-10 text-gray-600 font-light","aria-hidden":"true"})}),(0,s.jsx)("input",{type:"file",ref:i,onChange:function(e){t(e.target.files[0]),i.current.value=null},style:{display:"none"},disabled:n})]})}},45192:function(e,t,n){"use strict";var s=n(85893),a=(n(67294),n(68163)),r=n(86588),i=n(13902),l=n(40782),o=n(47941);t.Z=function(e){var t,n=e.fileInput,c=e.setFileInput,d=e.progress,u=function(){return c()};return(0,s.jsxs)("div",{children:[" ",(0,s.jsx)("div",{className:"my-3 max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden",children:(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-0 flex-1 flex justify-between",children:(0,s.jsxs)("p",{className:"w-0 flex-1 text-sm font-medium text-gray-900",children:[n.name," ",(0,s.jsxs)("span",{className:"font-light text-gray-500",children:["(",(0,o.G)(n.size),")"]})]})}),(0,s.jsx)("div",{className:"ml-4 flex-shrink-0 flex",children:t>0?(0,s.jsx)(r.gy,{height:"20",width:"20",color:"#312e81",ariaLabel:"loading"}):n.isError?(0,s.jsx)(i.Z,{onClick:function(){l.Am.error("Unable to upload file. Please try again."),u(file.id)},className:"h-6 w-6 text-red-600","aria-hidden":"true"}):(0,s.jsxs)("button",{type:"button",className:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:function(){return u()},children:[(0,s.jsx)("span",{className:"sr-only",children:"Close"}),(0,s.jsx)(a.Z,{className:"h-5 w-5","aria-hidden":"true"})]})})]}),d>0&&(0,s.jsx)("div",{className:"flex items-center pt-2",children:(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full dark:bg-gray-700 mx-20",children:(0,s.jsxs)("div",{className:"bg-blue-600 text-xs font-medium text-blue-100 text-center p-0.5 leading-none rounded-full",style:{width:"".concat(Math.floor(d),"%")},children:[" ",Math.floor(d),"%"]})})})]})})]})}},59758:function(e,t,n){"use strict";var s=n(85893),a=(n(67294),n(42833)),r=n(63090),i=n(93162),l=n(47941);t.Z=function(e){var t=e.message,n=e.myDid,o=e.fileObj;return(0,s.jsx)("div",{className:"bg-white px-4 py-5 border-2 border-gray-200 rounded-lg sm:px-6 mt-6",children:(0,s.jsxs)("div",{className:"-ml-4 -mt-4 flex justify-between items-center flex-wrap sm:flex-nowrap",children:[(0,s.jsx)("div",{className:"ml-4 mt-4",children:(0,s.jsx)("div",{className:"flex space-x-2 items-center",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("h3",{className:"text-md leading-6 break-all font-medium text-gray-900",children:t.data?t.data.name:"No File Name"}),(0,s.jsx)("p",{className:"mt-1 text-sm font-light text-gray-500",children:t.data&&"(".concat((0,l.G)(t.data.size),")")})]})})}),(0,s.jsx)("div",{className:"ml-4 mt-4 flex-shrink-0",children:t.from!==n&&(0,s.jsx)("button",{type:"button",onClick:function(){return function(){var e=t.data,n=e.id,s=e.name,a=e.type;o?(0,i.saveAs)(o,s):(0,r.X$)("file-download-request",{id:n,name:s,type:a})}()},className:"relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-gray-500 hover:text-black",children:(0,s.jsx)(a.Z,{className:"h-6 w-6","aria-hidden":"true"})})})]})})}},40532:function(e,t,n){"use strict";var s=n(85893),a=n(67294),r=n(11355),i=n(82546),l=n(86588);t.Z=function(e){var t=e.open,n=e.setOpen,o=e.progress;e.error;return(0,s.jsx)(r.u.Root,{show:t,as:a.Fragment,children:(0,s.jsxs)(i.V,{as:"div",className:"relative z-10",onClose:n,children:[(0,s.jsx)(r.u.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-25 transition-opacity"})}),(0,s.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:(0,s.jsx)("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:(0,s.jsx)(r.u.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,s.jsx)(i.V.Panel,{className:"relative transform overflow-hidden rounded-lg bg-white px-4 pt-5 pb-4 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-sm sm:p-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-gray-100",children:(0,s.jsx)(l.gy,{height:"40",width:"40",color:"#312e81",ariaLabel:"loading"})}),(0,s.jsxs)("div",{className:"mt-3 text-center sm:mt-5",children:[(0,s.jsx)(i.V.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:"Transferring file. Do not close."}),(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Peer to peer file transfer in progress. It make take some time for the recipient to receive the file (est. 1 min)."}),o>0&&(0,s.jsx)("div",{className:"flex items-center pt-2",children:(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full dark:bg-gray-700 mx-20",children:(0,s.jsxs)("div",{className:"bg-blue-600 text-xs font-medium text-blue-100 text-center p-0.5 leading-none rounded-full",style:{width:"".concat(Math.floor(o),"%")},children:[" ",Math.floor(o),"%"]})})}),100===o&&(0,s.jsx)("div",{className:"mt-5 sm:mt-6",children:(0,s.jsx)("button",{type:"button",className:"inline-flex w-full justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:text-sm",onClick:function(){return n(!1)},children:"File Transfer Complete!"})})]})]})]})})})})})]})})}},49332:function(e,t,n){"use strict";var s=n(67294);t.Z=function(e,t){(0,s.useEffect)((function(){if(e){e.style.height="40px",e.style.minHeight="40px";var t=e.scrollHeight;e.style.height=t+"px"}}),[e,t])}},41436:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return fe}});var s=n(35666),a=n.n(s),r=n(85893),i=n(60758),l=n(67294),o=n(30471),c=n(11355),d=n(82546),u=n(79691),m=n(13342),f=n(94323),x=n(57556),h=n(37051),v=n(5506),g=n(63750),p=n(40782),y=n(96467),j=(n(86588),n(30381)),b=n.n(j),w=n(18426),N=n(6218),C=n(46249),k=n(61751),O=n(37328),S=n(47193),Z=n(20567),F=n(59856),A=n(43101),P=n(91131),E=n(72045),I=n(82130),T=n(5152),z=n(51079),D=n(45192),K=n(82628),M=n.n(K),_=n(88247),L=n(59758),B=n(49332),U=n(85528),J=n(24796),R=n(40532),H=n(84152),V=n(73210),G=n(44156),X=n(14887),q=n(93107),$=n(11163);function Q(e,t,n,s,a,r,i){try{var l=e[r](i),o=l.value}catch(c){return void n(c)}l.done?t(o):Promise.resolve(o).then(s,a)}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},s=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),s.forEach((function(t){W(e,t,n[t])}))}return e}function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],s=!0,a=!1,r=void 0;try{for(var i,l=e[Symbol.iterator]();!(s=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);s=!0);}catch(o){a=!0,r=o}finally{try{s||null==l.return||l.return()}finally{if(a)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function te(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var ne=(0,T.default)((function(){return Promise.all([n.e(314),n.e(787),n.e(420)]).then(n.bind(n,52843))}),{loadableGenerated:{webpack:function(){return[52843]},modules:["d/chat.jsx -> ../../components/EmojiPicker"]},ssr:!1});function se(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ")}var ae=function(){var e=[{name:"Messages",href:"#",current:!0}];return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"sm:hidden",children:[(0,r.jsx)("label",{htmlFor:"tabs",className:"sr-only",children:"Select a tab"}),(0,r.jsx)("select",{id:"tabs",name:"tabs",className:"block w-full focus:ring-indigo-500 focus:border-indigo-500 border-gray-300",defaultValue:e.find((function(e){return e.current})).name,children:e.map((function(e){return(0,r.jsx)("option",{children:e.name},e.name)}))})]}),(0,r.jsx)("div",{className:"hidden sm:block",children:(0,r.jsx)("nav",{className:"relative z-0 shadow flex divide-x divide-gray-200","aria-label":"Tabs",children:e.map((function(e,t){return(0,r.jsxs)("a",{href:e.href,className:se(e.current?"text-gray-900":"text-gray-500 hover:text-gray-700","group relative min-w-0 flex-1 overflow-hidden bg-white py-4 px-4 text-sm font-medium text-center hover:bg-gray-50 focus:z-10"),"aria-current":e.current?"page":void 0,children:[(0,r.jsx)("span",{children:e.name}),(0,r.jsx)("span",{"aria-hidden":"true",className:se(e.current?"bg-indigo-500":"bg-transparent","absolute inset-x-0 bottom-0 h-0.5")})]},e.name)}))})})]})},re=function(e){var t=e.unreadMessages,n=e.message,s=(0,l.useState)(),a=s[0],i=s[1],o=(0,N.ff)().data,c=(0,C.LU)().data;(0,l.useEffect)((function(){var e=(0,J.Lz)({message:n,contacts:null===o||void 0===o?void 0:o.data.contacts,myDid:c});i(e[0])}),[n,null===o||void 0===o?void 0:o.data.contacts,c]);return(0,r.jsx)("div",{className:"flex items-center justify-between space-x-4",children:(0,r.jsxs)("div",{className:"flex space-x-4",children:[a&&(0,r.jsx)(U.Z,{contact:a,className:"w-10 h-10"}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("div",{className:"".concat(t>0?"font-bold":"font-light"," text-md flex items-center space-x-2"),children:[null===a||void 0===a?void 0:a.name,a&&(0,r.jsx)(X.Z,{contact:a,className:"ml-2 h-4 w-4"})]}),(0,r.jsx)("p",{className:"".concat(t?"font-bold":"font-light"," text-sm"),children:function(){if("https://didcomm.org/webrtc/1.0/sdp"===(null===n||void 0===n?void 0:n.data.type)){if("offer"===(null===n||void 0===n?void 0:n.data.body.content).signal.type)return(0,r.jsx)("span",{children:"Sent an invite to connect"})}else{if("file-transfer-done"===(null===n||void 0===n?void 0:n.data.type))return"File sent.";var e;if(!(0,S.p)(null===n||void 0===n?void 0:n.data.body.content))return"".concat(null===(e=null===n||void 0===n?void 0:n.data.body.content)||void 0===e?void 0:e.slice(0,20).toString());var t=JSON.parse(null===n||void 0===n?void 0:n.data.body.content);if(t.data){var s=t.data.name,a=t.dataUri;if(s&&a)return"File transfer."}}}()}),(0,r.jsx)("p",{className:"text-xs font-light",children:b().unix(null===n||void 0===n?void 0:n.data.created_time).fromNow()})]})]})})},ie=function(){var e=(0,l.useState)({}),t=e[0],n=e[1],s=(0,N.ff)().data,a=(0,C.LU)().data,i=(0,N.JA)().data,o=(0,V.p)().data,c=(0,k.mA)({myDid:a,contacts:null===s||void 0===s?void 0:s.data.contacts,blocklist:i,settings:o}).data,d=ee((0,P.KO)(A.D0),2)[1],u=ee((0,P.KO)(A.Lu),1)[0];return(0,l.useEffect)((function(){var e={};(null===c||void 0===c?void 0:c.conversations)&&(null===c||void 0===c||c.conversations.forEach((function(t){var n=t.messages.filter((function(e){return-1===u.indexOf(e.id)})).length;e[t.groupId]=n}))),n(e)}),[u,c]),(0,r.jsxs)("div",{className:"bg-white lg:min-w-0 lg:flex-1",children:[(0,r.jsx)("div",{className:"pl-4 pr-6 py-2 border-b border-t border-gray-200 sm:pl-6 lg:pl-8 xl:pl-6 xl:border-t-0",children:(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)("h1",{className:"flex-1 text-md font-medium",children:"Messages"})})}),(0,r.jsx)("ul",{role:"list",className:"relative z-0 divide-y divide-gray-200 border-b border-gray-200",children:null===c||void 0===c?void 0:c.conversations.map((function(e,n){var s=e.groupId,a=e.messages;return(0,r.jsx)("li",{className:"relative pl-4 pr-6 py-5 hover:bg-gray-50 sm:py-3 sm:pl-6 lg:pl-8 xl:pl-6 blue=",onClick:function(){return d(s)},children:(0,r.jsx)(re,{unreadMessages:t[s],message:a.slice(-1)[0]})},n)}))})]})},le=function(e){var t,n,s,a=e.setOpenContactPreview,i=e.setOpenPayment,d=e.sendInvite,f=e.activeConversation,h=e.nickname,v=ee((0,P.KO)(I._B),1)[0],y=ee((0,P.KO)(A.D0),2)[1],j=ee((0,P.KO)(A.w5),2),b=j[0],w=j[1],C=(0,k.bj)().mutate,S=(0,N.JA)().data,Z=(0,G.r)().data,F=ee((0,P.KO)(A.PF),2)[1],E=(0,$.useRouter)();return(0,r.jsx)("div",{className:"bg-white shadow",children:(0,r.jsx)("div",{className:"px-4 sm:px-6 lg:max-w-6xl lg:mx-auto lg:px-8",children:(0,r.jsxs)("div",{className:"py-2 md:flex md:items-center md:justify-between lg:border-t lg:border-gray-200",children:[(0,r.jsx)("div",{className:"flex-1 min-w-0",children:(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)("div",{className:"hover:bg-gray-100 pl-1 pr-5 rounded-md",children:(0,r.jsxs)("div",{className:"flex items-center",onClick:function(){return a(!0)},children:[(0,r.jsx)(U.Z,{contact:b,className:"w-10 h-10"}),(0,r.jsxs)("div",{className:"flex flex-col ml-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("h1",{className:"text-lg font-semibold leading-7 text-gray-900 sm:leading-9 sm:truncate",children:null===b||void 0===b?void 0:b.name}),b&&(0,r.jsx)(X.Z,{contact:b,className:"ml-2 h-4 w-4"})]}),"Unknown"===(null===b||void 0===b?void 0:b.name)&&h&&(0,r.jsxs)("h3",{className:"text-gray-500 font-normal text-sm",children:["(Maybe: ",h,")"]}),(null===b||void 0===b?void 0:b.metadata)&&(null===(t=JSON.parse(null===b||void 0===b?void 0:b.metadata))||void 0===t?void 0:t.username)&&(0,r.jsx)("a",{className:"text-sm text-blue-500 hover:underline font-normal",target:"_blank",rel:"noreferrer",href:"https://twitter.com/".concat(null===(n=JSON.parse(null===b||void 0===b?void 0:b.metadata))||void 0===n?void 0:n.username),children:"@".concat(null===(s=JSON.parse(null===b||void 0===b?void 0:b.metadata))||void 0===s?void 0:s.username)})]}),(null===S||void 0===S?void 0:S.includes(null===b||void 0===b?void 0:b.did))&&(0,r.jsx)("span",{className:"ml-2 inline-flex items-center rounded-md bg-red-100 px-2.5 py-0.5 text-sm font-medium text-red-800",children:"Blocked"})]})})})}),(0,r.jsxs)("div",{className:"mt-6 flex space-x-3 md:mt-0 md:ml-4 space-x-4",children:[(null===v||void 0===v?void 0:v.peer)&&(0,r.jsx)(r.Fragment,{children:(null===v||void 0===v?void 0:v.peer.connected)?(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-medium text-blue-400",children:"Connected"}):(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-medium text-gray-400",children:"Connecting ..."})}),(null===v||void 0===v?void 0:v.peer)?(0,r.jsx)("div",{className:"flex space-x-4",children:(0,r.jsxs)("button",{type:"button",onClick:function(){v.peer.destroy()},className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500",children:[(0,r.jsx)(x.Z,{className:"-ml-0.5 mr-2 h-4 w-4","aria-hidden":"true"}),(null===v||void 0===v?void 0:v.peer.connected)?"Disconnect":"Cancel"]})}):(0,r.jsxs)("button",{type:"button",onClick:function(){(null===S||void 0===S?void 0:S.includes(null===b||void 0===b?void 0:b.did))?p.Am.error("This contact is blocked, you will not be able to connect."):d()},className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-400 hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,r.jsx)(x.Z,{className:"-ml-0.5 mr-2 h-4 w-4","aria-hidden":"true"}),"Connect"]}),(0,r.jsxs)("button",{type:"button",onClick:function(){return F((function(e){return te(e).concat([b])})),void E.push("/d/meeting")},className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500",children:[(0,r.jsx)(u.Z,{className:"h-6 w-6 mr-2","aria-hidden":"true"}),"Meet"]}),(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsxs)("button",{type:"button",onClick:function(){(null===Z||void 0===Z?void 0:Z.data.lightningConfig.listening)?i(!0):p.Am.info("Connect to a lightning node to use this action.")},className:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[(0,r.jsx)(g.mly,{className:"-ml-0.5 mr-2 h-4 w-4","aria-hidden":"true"}),"Send"]})}),(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsxs)(o.v,{as:"div",className:"relative inline-block text-left",children:[(0,r.jsx)("div",{children:(0,r.jsxs)(o.v.Button,{className:"flex items-center text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-indigo-500",children:[(0,r.jsx)("span",{className:"sr-only",children:"Open options"}),(0,r.jsx)(m.Z,{className:"h-8 w-8","aria-hidden":"true"})]})}),(0,r.jsx)(c.u,{as:l.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,r.jsxs)(o.v.Items,{className:"origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-10",children:[(0,r.jsx)("div",{className:"py-1",children:(0,r.jsx)(o.v.Item,{children:function(e){var t=e.active;return(0,r.jsx)("div",{className:se(t&&"bg-gray-100","block py-2 text-sm"),children:(0,r.jsx)(H.Z,{did:b.did,asMenuItem:!0})})}})}),(0,r.jsx)("div",{className:"py-1",children:(0,r.jsx)(o.v.Item,{children:function(e){var t=e.active;return(0,r.jsx)("a",{onClick:function(){f&&(0,O.SJ)({groupId:f.groupId,deleteGroupMessage:C,callback:function(){y(),w()}})},className:se(t?"bg-gray-100 text-red-900":"text-red-700","block px-4 py-2 text-sm"),children:"Delete"})}})})]})})]})})]})]})})})},oe=function(e){var t=e.setToggleNewContact,n=e.toggleNewContact;return(0,r.jsx)("div",{className:"bg-white shadow",children:(0,r.jsx)("div",{className:"px-4 sm:px-6 py-2 lg:max-w-6xl lg:mx-auto lg:px-8 flex justify-end",children:(0,r.jsx)("button",{type:"button",onClick:function(){return t(!n)},className:"inline-flex items-center px-3 py-2 my-2 border border-transparent text-sm leading-4 font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:n?(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(f.Z,{className:"w-4 h-4"}),"Back"]}):(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(h.Z,{className:"w-4 h-4"}),"New Message"]})})})})},ce=function(e){var t=e.setToggleNewContact,n=e.setCurrentConversationContact,s=(0,N.ff)().data;return(0,r.jsxs)("div",{className:"bg-white lg:min-w-0 lg:flex-1",children:[(0,r.jsx)("div",{className:"pl-4 pr-6 py-4 border-b flex items-center justify-center border-primary sm:pl-6 lg:pl-8 xl:pl-6",children:(0,r.jsx)("h4",{className:"font-semibold text-sm",children:"Select a Contact"})}),(0,r.jsx)("ul",{role:"list",className:"relative z-0 divide-y divide-gray-200 border-b border-gray-200",children:s.data.contacts.map((function(e,s){return(0,r.jsx)("li",{onClick:function(){n(e),t(!1)},className:"relative pl-4 pr-6 py-5 hover:bg-gray-50 sm:py-3 sm:pl-6 lg:pl-8 xl:pl-6 blue=",children:(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsxs)("div",{className:"flex space-x-4",children:[(0,r.jsx)(U.Z,{contact:e,className:"h-10 w-10"}),(0,r.jsx)("div",{className:"flex flex-col justify-center",children:(0,r.jsx)("p",{className:"font-base",children:e.name})})]})})},s)}))})]})},de=function(e){var t=e.sendBasicMessage,n=e.myDid,s=65535,i=(0,l.useState)(""),o=i[0],c=i[1],d=(0,l.useState)(),u=d[0],m=d[1],f=(0,l.useState)(1),x=f[0],h=f[1],v=(0,l.useState)(),g=v[0],y=v[1],j=(0,l.useState)(0),b=j[0],w=j[1],N=(0,l.useState)(s),C=N[0],O=N[1],S=(0,l.useState)(0),Z=S[0],F=S[1],T=(0,l.useState)(""),K=T[0],M=T[1],L=(0,l.useState)(0),U=L[0],J=L[1],H=(0,l.useState)(0),G=H[0],X=H[1],q=(0,l.useState)(!1),$=q[0],W=q[1],te=ee((0,P.KO)(A.r2),1)[0],se=ee((0,P.KO)(I._B),1)[0],ae=ee((0,P.KO)(A.D0),1)[0],re=ee((0,P.KO)(I.Uy),1)[0],ie=ee((0,P.KO)(A.w5),1)[0],le=(0,k.de)().mutate,oe=(0,V.p)().data,ce=(0,l.useRef)(null);(0,B.Z)(ce.current,o);var de=function(){p.Am.error("Error sending message. Please try again.")};(0,l.useEffect)((function(){U>0&&fe(x)}),[g,Z]);var ue,me=(ue=a().mark((function e(){var t,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return xe(),W(!0),M((0,E.Z)()),e.next=5,u.arrayBuffer();case 5:t=e.sent,J(t.byteLength),n=t.byteLength%s==0?t.byteLength/s:Math.floor(t.byteLength/s)+1,X(n),y(t);case 10:case"end":return e.stop()}}),e)})),function(){var e=this,t=arguments;return new Promise((function(n,s){var a=ue.apply(e,t);function r(e){Q(a,n,s,r,i,"next",e)}function i(e){Q(a,n,s,r,i,"throw",e)}r(void 0)}))}),fe=function(){if(h(x+1),x<=G){var e=g.slice(b,C);if(ve({id:K,data:e},"file-transfer-chunk"),w(C),O(C+s),x==G)console.log("Process is complete, counter",x),F(100),ge();else F(x/G*100)}},xe=function(){F(0),h(1),w(0),O(s)},he=function(e){t({msg:e||o,did:ie.did,type:"https://didcomm.org/basicmessage/2.0/message",amount:te?50:0,reply_to_id:"",isPayment:!1,settings:oe},{onError:de})},ve=function(e,t){var s,a;if("file-transfer-chunk"!==t){var r=(null===se||void 0===se?void 0:se.metadata.networkId)!==re?null===se||void 0===se?void 0:se.metadata.networkId:null,i={timestamp:(new Date).toString(),from:n.id,did:ie.did,networkId:r,type:t,metadata:{nickname:(null===oe||void 0===oe||null===(s=oe.identity)||void 0===s?void 0:s.nickname)?null===oe||void 0===oe||null===(a=oe.identity)||void 0===a?void 0:a.nickname:""}},l=Y("live-message"===t?{msg:e}:{data:e},i);console.log("sending webrtc payload: ",l),null===se||void 0===se||se.peer.write(JSON.stringify(l))}else{var o="".concat(e.id,":").concat((0,_.c)(e.data));null===se||void 0===se||se.peer.write(o)}},ge=function(){var e=u.name,t=u.type,s=u.size;if(console.log("File transfer is complete: ",e),ve({name:e,type:t,size:s,id:K},"file-transfer-done"),"image"===t.split("/")[0]){var a=new FileReader;a.readAsDataURL(u),a.onloadend=function(){le({msg:{name:e,type:t,size:s,id:K,image:a.result},type:"file-transfer-done",from:n.id,did:ie.did,settings:oe})}}else le({msg:{name:e,type:t,size:s,id:K,image:""},type:"file-transfer-done",from:n.id,did:ie.did,settings:oe});m(),y(),W(!1),F(0)},pe=function(){if(u&&function(){if(se)me();else if(!se&&u.size>2e6)p.Am.error("File size is too large to send. (Max 2MB). Please connect with user to send larger files.");else{var e=new FileReader;e.readAsDataURL(u),e.onloadend=function(){he(JSON.stringify({data:{name:u.name},dataUri:e.result})),m()}}}(),o.length>0&&(ae||ie)){if(se)return ve(o,"live-message"),le({msg:o,type:"live-message",from:n.id,did:ie.did,settings:oe}),void c("");he()}c("")};return(0,r.jsxs)("div",{className:"bg-white shadow px-4",children:[u&&(0,r.jsx)(D.Z,{fileInput:u,setFileInput:m,progress:Z}),(0,r.jsxs)("div",{className:"px-2 sm:px-6 lg:max-w-6xl lg:mx-auto lg:px-8",children:[(0,r.jsx)("div",{className:"py-2 md:flex md:items-center md:justify-between lg:border-t lg:border-gray-200",children:(0,r.jsxs)("div",{className:"mt-6 flex space-x-3 md:mt-0 md:ml-4 w-full items-end",children:[(0,r.jsx)(ne,{onEmojiSelect:function(e){c((function(t){return t.concat(" ".concat(e.native," "))}))}}),(0,r.jsx)(z.Z,{setFile:m}),(0,r.jsx)("textarea",{name:"name",id:"name",ref:ce,value:o,onKeyPress:function(e){e.shiftKey&&"Enter"===e.key?c("".concat(o)):"Enter"!==e.key||pe()},onChange:function(e){"\n"!==e.target.value&&c(e.target.value)},className:"tracking-wide shadow-sm focus:ring-primary focus:border-primary border-primary border block w-full sm:text-sm border-gray-300 px-4 rounded-md pt-2",placeholder:"Start a new message"}),(0,r.jsx)("button",{type:"button",onClick:function(){return pe()},className:"max-h-10 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500",children:"Send"})]})}),(0,r.jsx)(R.Z,{open:$,setOpen:W,progress:Z})]})]})},ue=function(e){var t=e.activeConversation,n=(0,l.useState)([]),s=n[0],a=n[1],i=(0,N.ff)().data,o=(0,C.LU)().data,c=ee((0,P.KO)(A.Lu),2),d=c[0],u=c[1],m=ee((0,P.KO)(I._B),1)[0],f=(0,l.useRef)(null);(0,l.useEffect)((function(){var e;null===(e=f.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})),(0,l.useEffect)((function(){t?(a(t.messages),u((0,O.MQ)(d,t.messages))):a([])}),[d,u,t]);var x=function(e){if("https://didcomm.org/webrtc/1.0/sdp"===e.data.type)return"offer"===e.data.body.content.signal.type?(0,r.jsxs)("p",{children:["Sent an invitiation to connect."," ",(0,O.qP)(e.data.created_time)&&(0,Z.Ho)(e.data.from)!==o.id&&(0,r.jsx)("a",{className:"font-bold underline",onClick:function(){return(0,F.WV)({detail:{message:e.data.body.content,knownContact:(0,J.Er)({shortFormDid:(0,Z.Ho)(e.data.from),contacts:i.data.contacts}),sourceType:"didcomm"}})},children:"Show"})]}):"Sent you an invite to connect.";if("file-transfer-done"===e.data.type)return e.data.body.content.image?(0,r.jsx)("img",{src:e.data.body.content.image,alt:"",width:500,height:500}):(0,r.jsx)(L.Z,{message:{data:e.data.body.content,from:(0,Z.Ho)(e.data.from)},myDid:o.id});var t=e.data.body.content;if(!(0,S.p)(t))return t;if(JSON.parse(t).data){var n=JSON.parse(t),s=n.data.name,a=n.dataUri;if(s&&M()().test(a)){var l=atob(a.split(",")[1]),c=a.split(",")[0].split(":")[1].split(";")[0];if("image"===c.split("/")[0])return(0,r.jsx)("img",{src:a,alt:"",width:500,height:500});for(var d=new Uint8Array(l.length),u=0;u<l.length;u++)d[u]=l.charCodeAt(u);var m=new File([d],s,{type:c});return(0,r.jsx)(L.Z,{message:{data:{name:s,type:c,size:m.size,id:null},from:e.data.from},fileObj:m,myDid:o.id})}return t}};return(0,r.jsxs)("div",{className:"flex flex-col w-full h-full pt-6 overflow-y-auto",children:[s.map((function(e,t){return(0,r.jsx)("div",{className:"flex py-1 ".concat((0,Z.Ho)(e.data.from)===o.id?"pl-4 flex-row-reverse":"pr-4"),children:(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"px-4 py-2 rounded-lg inline-block rounded-br-none text-sm whitespace-pre-line ".concat((n=(0,Z.Ho)(e.data.from),n===o.id?(null===m||void 0===m?void 0:m.peer.connected)?"bg-blue-600 text-white":"bg-secondary text-white":"bg-gray-200 text-gray-800")),children:x(e)}),e.data.body.payment&&(0,r.jsxs)("p",{className:"text-sm inline-flex text-center",children:[(0,Z.Ho)(e.data.from)===o.id?"Sent":"Received",": +",parseInt(e.data.body.payment).toLocaleString()," sats"," ",(0,r.jsx)(g.mly,{className:"w-3 h-3 mt-1.5 ml-0.5"})]}),(0,r.jsx)("div",{className:"flex ".concat((0,Z.Ho)(e.data.from)===o.id&&"flex-row-reverse"),children:(0,r.jsx)("p",{className:"text-primary opacity-30 text-xs",children:b().unix(e.data.created_time).fromNow()})})]})},t);var n})),(0,r.jsx)("div",{ref:f})]})},me=function(e){var t=e.openContactPreview,n=e.setOpenContactPreview,s=e.currentConversationContact,a=e.nickname;return(0,r.jsx)(c.u.Root,{show:t,as:l.Fragment,children:(0,r.jsx)(d.V,{as:"div",className:"fixed inset-0 overflow-hidden z-10",onClose:n,children:(0,r.jsxs)("div",{className:"absolute inset-0 overflow-hidden",children:[(0,r.jsx)(d.V.Overlay,{className:"absolute inset-0"}),(0,r.jsx)("div",{className:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10",children:(0,r.jsx)(c.u.Child,{as:l.Fragment,enter:"transform transition ease-in-out duration-500 sm:duration-700",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transform transition ease-in-out duration-500 sm:duration-700",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:(0,r.jsx)("div",{className:"pointer-events-auto w-screen max-w-md",children:(0,r.jsxs)("div",{className:"flex h-full flex-col overflow-y-scroll bg-white py-6 shadow-xl",children:[(0,r.jsx)("div",{className:"px-4 sm:px-6",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)(d.V.Title,{className:"text-lg font-medium text-gray-900",children:[" ","Contact"," "]}),(0,r.jsx)("div",{className:"ml-3 flex h-7 items-center",children:(0,r.jsxs)("button",{type:"button",className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:function(){return n(!1)},children:[(0,r.jsx)("span",{className:"sr-only",children:"Close panel"}),(0,r.jsx)(v.Z,{className:"h-6 w-6","aria-hidden":"true"})]})})]})}),(0,r.jsx)("div",{className:"relative mt-6 flex-1 px-4 sm:px-6",children:(0,r.jsx)(y.ContactView,{selectedContact:s,nickname:a})})]})})})})]})})})};function fe(){var e=(0,l.useState)(!1),t=e[0],n=e[1],s=(0,l.useState)(!1),a=s[0],o=s[1],c=(0,l.useState)(!1),d=c[0],u=c[1],m=(0,l.useState)(),f=m[0],x=m[1],h=(0,l.useState)(""),v=h[0],g=h[1],y=ee((0,P.KO)(A.D0),2),j=y[0],b=y[1],O=ee((0,P.KO)(A.w5),2),S=O[0],Z=O[1],T=ee((0,P.KO)(I.fo),2)[1],z=ee((0,P.KO)(A.r2),1)[0],D=(0,N.ff)().data,K=(0,C.LU)().data,M=(0,N.JA)().data,_=(0,V.p)().data,L=(0,k.mA)({myDid:K,contacts:null===D||void 0===D?void 0:D.data.contacts,blocklist:M,settings:_}).data,B=(0,k.$3)().mutate;(0,l.useEffect)((function(){if(f){var e=(0,J.zi)({messages:f.messages,contact:S});e&&g(e)}}),[f,S]),(0,l.useEffect)((function(){if(j){var e=null===L||void 0===L?void 0:L.conversations.find((function(e){return e.groupId===j}));if(e){var t=(0,J.Lz)({message:e.messages[0],contacts:null===D||void 0===D?void 0:D.data.contacts,myDid:K});x(e),Z(t[0])}}}),[null===D||void 0===D?void 0:D.data.contacts,j,null===L||void 0===L?void 0:L.conversations,K,Z]),(0,l.useEffect)((function(){if(S){var e=null===L||void 0===L?void 0:L.conversations.find((function(e){return e.messages.find((function(e){return e.recipients.includes(S.did)}))}));e?x(e):(x(),b())}}),[j,Z,null===D||void 0===D?void 0:D.data.contacts,K,L,S,b]);return(0,r.jsxs)(i.Z,{currentPage:"Messaging",children:[(0,r.jsx)(w.Z,{open:a,setOpen:o,selectedContact:S||null}),(0,r.jsx)("div",{className:"z-20",children:(0,r.jsx)(me,{openContactPreview:t,setOpenContactPreview:n,currentConversationContact:S,nickname:v})}),(0,r.jsxs)("div",{className:"flex h-full",children:[(0,r.jsxs)("div",{className:"flex-1 relative z-0 flex overflow-hidden w-5/6",children:[(0,r.jsx)("main",{className:"flex-1 relative z-0 overflow-y-auto focus:outline-none xl:order-last bg-white border-r",children:(j||S)&&(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"flex-none",children:(0,r.jsx)(le,{setOpenContactPreview:n,setOpenPayment:o,sendInvite:function(){var e=(0,E.Z)(),t=(0,F.aH)({networkId:e,networkOwner:K.id,sendBasicMessage:B,lightningEnabled:z,src:K.id,contact:S,type:"live-messaging-invitation",localStream:!1,settings:_});p.Am.success("Invite Sent"),T(t)},activeConversation:f,nickname:v})}),(0,r.jsx)("div",{className:"grow flex-1 pl-8 pr-4 overflow-hidden",children:(0,r.jsx)(ue,{activeConversation:f})}),(0,r.jsx)("div",{className:"flex-none",children:(0,r.jsx)(de,{sendBasicMessage:B,myDid:K})})]})})}),(0,r.jsxs)("aside",{className:"hidden relative xl:order-first xl:flex xl:flex-col flex-shrink-0 w-80 border-r border-gray-200 overflow-y-auto",children:[(0,r.jsx)(oe,{setToggleNewContact:u,toggleNewContact:d}),d?(0,r.jsx)(ce,{setToggleNewContact:u,setCurrentConversationContact:Z}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ae,{}),(0,r.jsx)(ie,{})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-col w-1/6 border-1 border-l overflow-y-scroll",children:[(0,r.jsx)("div",{className:"flex justify-center py-4",children:(0,r.jsx)("h2",{className:"text-sm font-medium text-gray-500 uppercase",children:"Contacts"})}),(0,r.jsx)(q.Z,{})]})]})]})}}},function(e){e.O(0,[774,445,13,270,14,752,758,467,888,179],(function(){return t=72848,e(e.s=t);var t}));var t=e.O();_N_E=t}]);