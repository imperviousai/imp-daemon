(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[843],{72848:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/d/chat",function(){return n(41436)}])},51079:function(e,t,n){"use strict";var s=n(85893),a=n(67294),i=n(42633);t.Z=function(e){var t=e.setFile,n=e.disabled,r=(0,a.useRef)(null);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{type:"button",onClick:function(e){r.current.click()},children:(0,s.jsx)(i.Z,{className:"h-10 w-10 text-gray-600 font-light","aria-hidden":"true"})}),(0,s.jsx)("input",{type:"file",ref:r,onChange:function(e){t(e.target.files[0]),r.current.value=null},style:{display:"none"},disabled:n})]})}},45192:function(e,t,n){"use strict";var s=n(85893),a=(n(67294),n(68163)),i=n(86588),r=n(13902),l=n(40782);t.Z=function(e){var t,n=e.fileInput,o=e.setFileInput,c=e.progress,d=function(){return o()};return(0,s.jsxs)("div",{children:[" ",(0,s.jsx)("div",{className:"my-3 max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden",children:(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-0 flex-1 flex justify-between",children:(0,s.jsxs)("p",{className:"w-0 flex-1 text-sm font-medium text-gray-900",children:[n.name," ",(0,s.jsxs)("span",{className:"font-light text-gray-500",children:["(",n.size," bytes)"]})]})}),(0,s.jsx)("div",{className:"ml-4 flex-shrink-0 flex",children:t>0?(0,s.jsx)(i.gy,{height:"20",width:"20",color:"#312e81",ariaLabel:"loading"}):n.isError?(0,s.jsx)(r.Z,{onClick:function(){l.Am.error("Unable to upload file. Please try again."),d(file.id)},className:"h-6 w-6 text-red-600","aria-hidden":"true"}):(0,s.jsxs)("button",{type:"button",className:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:function(){return d()},children:[(0,s.jsx)("span",{className:"sr-only",children:"Close"}),(0,s.jsx)(a.Z,{className:"h-5 w-5","aria-hidden":"true"})]})})]}),c>0&&(0,s.jsx)("div",{className:"flex items-center pt-2",children:(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full dark:bg-gray-700 mx-20",children:(0,s.jsxs)("div",{className:"bg-blue-600 text-xs font-medium text-blue-100 text-center p-0.5 leading-none rounded-full",style:{width:"".concat(Math.floor(c),"%")},children:[" ",Math.floor(c),"%"]})})})]})})]})}},59758:function(e,t,n){"use strict";var s=n(85893),a=(n(67294),n(42833)),i=n(63090),r=n(93162);t.Z=function(e){var t=e.message,n=e.myDid,l=e.fileObj;return(0,s.jsx)("div",{className:"bg-white px-4 py-5 border-2 border-gray-200 rounded-lg sm:px-6 mt-6",children:(0,s.jsxs)("div",{className:"-ml-4 -mt-4 flex justify-between items-center flex-wrap sm:flex-nowrap",children:[(0,s.jsx)("div",{className:"ml-4 mt-4",children:(0,s.jsx)("div",{className:"flex space-x-2 items-center",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("h3",{className:"text-md leading-6 break-all font-medium text-gray-900",children:t.data?t.data.name:"No File Name"}),(0,s.jsx)("p",{className:"mt-1 text-sm font-light text-gray-500",children:t.data&&"(".concat(t.data.size," bytes)")})]})})}),(0,s.jsx)("div",{className:"ml-4 mt-4 flex-shrink-0",children:t.from!==n&&(0,s.jsx)("button",{type:"button",onClick:function(){return function(){var e=t.data,n=e.id,s=e.name,a=e.type;l?(0,r.saveAs)(l,s):(0,i.X$)("file-download-request",{id:n,name:s,type:a})}()},className:"relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-gray-500 hover:text-black",children:(0,s.jsx)(a.Z,{className:"h-6 w-6","aria-hidden":"true"})})})]})})}},49332:function(e,t,n){"use strict";var s=n(67294);t.Z=function(e,t){(0,s.useEffect)((function(){if(e){e.style.height="40px",e.style.minHeight="40px";var t=e.scrollHeight;e.style.height=t+"px"}}),[e,t])}},41436:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return W}});var s=n(85893),a=n(11240),i=n(67294),r=n(56727),l=n(13342),o=n(94323),c=n(57556),d=n(37051),m=n(5506),u=n(63750),f=n(40782),x=n(10267),v=(n(86588),n(30381)),g=n.n(v),h=n(18426),p=n(6218),y=n(46249),j=n(61751),b=n(37328),N=n(20567),w=n(59856),C=n(43101),k=n(91131),O=n(72045),S=n(82130),E=n(5152),F=n(51079),Z=n(45192),z=n(82628),I=n.n(z),P=(n(88247),n(59758)),D=n(49332),_=n(85528),K=n(24796);function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},s=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),s.forEach((function(t){T(e,t,n[t])}))}return e}function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],s=!0,a=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(s=(r=l.next()).done)&&(n.push(r.value),!t||n.length!==t);s=!0);}catch(o){a=!0,i=o}finally{try{s||null==l.return||l.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var L=function(e){return(e.includes("{")||e.includes("}"))&&JSON.parse(e)},U=(0,E.default)((function(){return Promise.all([n.e(314),n.e(787),n.e(420)]).then(n.bind(n,52843))}),{loadableGenerated:{webpack:function(){return[52843]},modules:["d/chat.jsx -> ../../components/EmojiPicker"]},ssr:!1});function R(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ")}var H=function(){var e=[{name:"Messages",href:"#",current:!0}];return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"sm:hidden",children:[(0,s.jsx)("label",{htmlFor:"tabs",className:"sr-only",children:"Select a tab"}),(0,s.jsx)("select",{id:"tabs",name:"tabs",className:"block w-full focus:ring-indigo-500 focus:border-indigo-500 border-gray-300",defaultValue:e.find((function(e){return e.current})).name,children:e.map((function(e){return(0,s.jsx)("option",{children:e.name},e.name)}))})]}),(0,s.jsx)("div",{className:"hidden sm:block",children:(0,s.jsx)("nav",{className:"relative z-0 shadow flex divide-x divide-gray-200","aria-label":"Tabs",children:e.map((function(e,t){return(0,s.jsxs)("a",{href:e.href,className:R(e.current?"text-gray-900":"text-gray-500 hover:text-gray-700","group relative min-w-0 flex-1 overflow-hidden bg-white py-4 px-4 text-sm font-medium text-center hover:bg-gray-50 focus:z-10"),"aria-current":e.current?"page":void 0,children:[(0,s.jsx)("span",{children:e.name}),(0,s.jsx)("span",{"aria-hidden":"true",className:R(e.current?"bg-indigo-500":"bg-transparent","absolute inset-x-0 bottom-0 h-0.5")})]},e.name)}))})})]})},B=function(e){var t=e.unreadMessages,n=e.message,a=(0,i.useState)(),r=a[0],l=a[1],o=(0,p.ff)().data,c=(0,y.LU)().data;(0,i.useEffect)((function(){var e=(0,K.Lz)({message:n,contacts:null===o||void 0===o?void 0:o.data.contacts,myDid:c});l(e[0])}),[n,null===o||void 0===o?void 0:o.data.contacts,c]);return(0,s.jsxs)("div",{className:"flex items-center justify-between space-x-4",children:[(0,s.jsxs)("div",{className:"flex space-x-4",children:[r&&(0,s.jsx)(_.Z,{contact:r,className:"w-10 h-10"}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("p",{className:"".concat(t>0?"font-bold":"font-light"," text-md"),children:null===r||void 0===r?void 0:r.name}),(0,s.jsx)("p",{className:"".concat(t?"font-bold":"font-light"," text-sm"),children:function(){if("https://didcomm.org/webrtc/1.0/sdp"===(null===n||void 0===n?void 0:n.data.type)){if("offer"===(null===n||void 0===n?void 0:n.data.body.content).signal.type)return(0,s.jsx)("span",{children:"Sent an invite to connect"})}else{if("file-transfer-done"===(null===n||void 0===n?void 0:n.data.type))return"File sent.";var e;if(!L(null===n||void 0===n?void 0:n.data.body.content))return"".concat(null===(e=null===n||void 0===n?void 0:n.data.body.content)||void 0===e?void 0:e.slice(0,20));var t=JSON.parse(null===n||void 0===n?void 0:n.data.body.content),a=t.filename,i=t.dataUri;if(a&&i)return"File sent."}}()})]})]}),(0,s.jsx)("div",{className:"flex flex-col pb-4",children:(0,s.jsx)("p",{className:"text-sm font-light",children:g().unix(null===n||void 0===n?void 0:n.data.created_time).fromNow()})})]})},V=function(){var e=(0,i.useState)({}),t=e[0],n=e[1],a=(0,p.ff)().data,r=(0,y.LU)().data,l=(0,j.mA)({myDid:r,contacts:null===a||void 0===a?void 0:a.data.contacts}).data,o=A((0,k.KO)(C.D0),2)[1],c=A((0,k.KO)(C.Lu),1)[0];return(0,i.useEffect)((function(){var e={};(null===l||void 0===l?void 0:l.conversations)&&(null===l||void 0===l||l.conversations.forEach((function(t){var n=t.messages.filter((function(e){return-1===c.indexOf(e.id)})).length;e[t.groupId]=n}))),n(e)}),[c,l]),(0,s.jsxs)("div",{className:"bg-white lg:min-w-0 lg:flex-1",children:[(0,s.jsx)("div",{className:"pl-4 pr-6 py-2 border-b border-t border-gray-200 sm:pl-6 lg:pl-8 xl:pl-6 xl:border-t-0",children:(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)("h1",{className:"flex-1 text-md font-medium",children:"Messages"})})}),(0,s.jsx)("ul",{role:"list",className:"relative z-0 divide-y divide-gray-200 border-b border-gray-200",children:null===l||void 0===l?void 0:l.conversations.map((function(e,n){var a=e.groupId,i=e.messages;return(0,s.jsx)("li",{className:"relative pl-4 pr-6 py-5 hover:bg-gray-50 sm:py-3 sm:pl-6 lg:pl-8 xl:pl-6 blue=",onClick:function(){return o(a)},children:(0,s.jsx)(B,{unreadMessages:t[a],message:i.slice(-1)[0]})},n)}))})]})},J=function(e){var t=e.setOpenContactPreview,n=e.setOpenPayment,a=e.sendInvite,o=e.activeConversation,d=A((0,k.KO)(S._B),1)[0],m=A((0,k.KO)(C.D0),2)[1],f=A((0,k.KO)(C.w5),2),x=f[0],v=f[1],g=(0,j.bj)().mutate;return(0,s.jsx)("div",{className:"bg-white shadow",children:(0,s.jsx)("div",{className:"px-4 sm:px-6 lg:max-w-6xl lg:mx-auto lg:px-8",children:(0,s.jsxs)("div",{className:"py-2 md:flex md:items-center md:justify-between lg:border-t lg:border-gray-200",children:[(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"flex items-center",onClick:function(){return t(!0)},children:[(0,s.jsx)(_.Z,{contact:x,className:"w-10 h-10"}),(0,s.jsx)("div",{className:"flex flex-col ml-3",children:(0,s.jsxs)("h1",{className:"text-lg font-semibold leading-7 text-gray-900 sm:leading-9 sm:truncate",children:[null===x||void 0===x?void 0:x.name," "]})})]})})})}),(0,s.jsxs)("div",{className:"mt-6 flex space-x-3 md:mt-0 md:ml-4 space-x-4",children:[(null===d||void 0===d?void 0:d.peer)&&(0,s.jsx)(s.Fragment,{children:(null===d||void 0===d?void 0:d.peer.connected)?(0,s.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-medium text-blue-400",children:"Connected"}):(0,s.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-medium text-gray-400",children:"Connecting ..."})}),(null===d||void 0===d?void 0:d.peer)?(0,s.jsx)("div",{className:"flex space-x-4",children:(0,s.jsxs)("button",{type:"button",onClick:function(){d.peer.destroy()},className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500",children:[(0,s.jsx)(c.Z,{className:"-ml-0.5 mr-2 h-4 w-4","aria-hidden":"true"}),(null===d||void 0===d?void 0:d.peer.connected)?"Disconnect":"Cancel"]})}):(0,s.jsxs)("button",{type:"button",onClick:function(){return a()},className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-400 hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,s.jsx)(c.Z,{className:"-ml-0.5 mr-2 h-4 w-4","aria-hidden":"true"}),"Connect"]}),(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)("button",{type:"button",onClick:function(){return n(!0)},className:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[(0,s.jsx)(u.mly,{className:"-ml-0.5 mr-2 h-4 w-4","aria-hidden":"true"}),"Send"]})}),(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)(r.v2,{as:"div",className:"relative inline-block text-left",children:[(0,s.jsx)("div",{children:(0,s.jsxs)(r.v2.Button,{className:"flex items-center text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-indigo-500",children:[(0,s.jsx)("span",{className:"sr-only",children:"Open options"}),(0,s.jsx)(l.Z,{className:"h-8 w-8","aria-hidden":"true"})]})}),(0,s.jsx)(r.uT,{as:i.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,s.jsx)(r.v2.Items,{className:"origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-10",children:(0,s.jsx)("div",{className:"py-1",children:(0,s.jsx)(r.v2.Item,{children:function(e){var t=e.active;return(0,s.jsx)("a",{onClick:function(){o&&(0,b.SJ)({groupId:o.groupId,deleteGroupMessage:g,callback:function(){m(),v()}})},className:R(t?"bg-gray-100 text-red-900":"text-red-700","block px-4 py-2 text-sm"),children:"Delete"})}})})})})]})})]})]})})})},q=function(e){var t=e.setToggleNewContact,n=e.toggleNewContact;return(0,s.jsx)("div",{className:"bg-white shadow",children:(0,s.jsx)("div",{className:"px-4 sm:px-6 py-2 lg:max-w-6xl lg:mx-auto lg:px-8 flex justify-end",children:(0,s.jsx)("button",{type:"button",onClick:function(){return t(!n)},className:"inline-flex items-center px-3 py-2 my-2 border border-transparent text-sm leading-4 font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:n?(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(o.Z,{className:"w-4 h-4"}),"Back"]}):(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(d.Z,{className:"w-4 h-4"}),"New Message"]})})})})},G=function(e){var t=e.setToggleNewContact,n=e.setCurrentConversationContact,a=(0,p.ff)().data;return(0,s.jsxs)("div",{className:"bg-white lg:min-w-0 lg:flex-1",children:[(0,s.jsx)("div",{className:"pl-4 pr-6 py-4 border-b flex items-center justify-center border-primary sm:pl-6 lg:pl-8 xl:pl-6",children:(0,s.jsx)("h4",{className:"font-semibold text-sm",children:"Select a Contact"})}),(0,s.jsx)("ul",{role:"list",className:"relative z-0 divide-y divide-gray-200 border-b border-gray-200",children:a.data.contacts.map((function(e,a){return(0,s.jsx)("li",{onClick:function(){n(e),t(!1)},className:"relative pl-4 pr-6 py-5 hover:bg-gray-50 sm:py-3 sm:pl-6 lg:pl-8 xl:pl-6 blue=",children:(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)(_.Z,{contact:e,className:"h-10 w-10"}),(0,s.jsx)("div",{className:"flex flex-col justify-center",children:(0,s.jsx)("p",{className:"font-base",children:e.name})})]})})},a)}))})]})},X=function(e){var t=e.sendBasicMessage,n=e.myDid,a=3145728,r=(0,i.useState)(""),l=r[0],o=r[1],c=(0,i.useState)(),d=c[0],m=c[1],u=(0,i.useState)(1),x=u[0],v=u[1],g=(0,i.useState)({}),h=g[0],p=g[1],y=(0,i.useState)(0),b=y[0],N=y[1],w=(0,i.useState)(a),E=w[0],z=w[1],I=(0,i.useState)(0),P=I[0],_=I[1],K=(0,i.useState)(""),T=K[0],L=K[1],R=(0,i.useState)(0),H=R[0],B=R[1],V=(0,i.useState)(0),J=V[0],q=V[1],G=A((0,k.KO)(C.r2),1)[0],X=A((0,k.KO)(S._B),1)[0],$=A((0,k.KO)(C.D0),1)[0],Q=A((0,k.KO)(S.Uy),1)[0],W=A((0,k.KO)(C.w5),1)[0],Y=(0,j.de)().mutate,ee=(0,i.useRef)(null);(0,D.Z)(ee.current,l);var te=function(){f.Am.error("Error sending message. Please try again.")};(0,i.useEffect)((function(){H>0&&ne(x)}),[h,P]);var ne=function(){if(v(x+1),x<=J){var e=h.name,t=h.type,n=h.slice(b,E);if(ie({name:e,type:t,id:T,data:n},"file-transfer-chunk"),N(E),z(E+a),x==J)console.log("Process is complete, counter",x),_(100),re();else{var s=x/J*100;_(s),console.log("SENDING FILE TRANSFER, PERCENTILE",s),console.log("CHUNK: ",n)}}},se=function(){_(0),v(1),N(0),z(a)},ae=function(e){t({msg:e||l,did:W.did,type:"https://didcomm.org/basicmessage/2.0/message",amount:G?50:0,reply_to_id:"",isPayment:!1},{onError:te})},ie=function(e,t){var s=X.metadata.networkId!==Q?X.metadata.networkId:null,a={timestamp:(new Date).toString(),from:n.id,did:W.did,networkId:s,type:t},i=M("live-message"===t?{msg:e}:{data:e},a);X.peer.write(JSON.stringify(i))},re=function(){var e=d.name,t=d.type,s=d.size;if(console.log("File transfer is complete: ",e),ie({name:e,type:t,size:s,id:T},"file-transfer-done"),"image"===t.split("/")[0]){var a=new FileReader;a.readAsDataURL(d),a.onloadend=function(){Y({msg:{name:e,type:t,size:s,id:T,image:a.result},type:"file-transfer-done",from:n.id,did:W.did})}}else Y({msg:{name:e,type:t,size:s,id:T,image:""},type:"file-transfer-done",from:n.id,did:W.did});m(),p(),_(0)},le=function(){if(X)!function(){se(),B(d.size);var e=d.size%a==0?d.size/a:Math.floor(d.size/a)+1;q(e),console.log("fileInput",d),p(d),L((0,O.Z)())}();else if(!X&&d.size>2e6)f.Am.error("File size is too large to send. (Max 2MB). Please connect with user to send larger files.");else{var e=new FileReader;e.readAsDataURL(d),e.onloadend=function(){ae(JSON.stringify({data:{name:d.name},dataUri:e.result})),m()}}},oe=function(){if(d&&le(),l.length>0&&($||W)){if(X)return ie(l,"live-message"),Y({msg:l,type:"live-message",from:n.id,did:W.did}),void o("");ae()}o("")};return(0,s.jsxs)("div",{className:"bg-white shadow px-4",children:[d&&(0,s.jsx)(Z.Z,{fileInput:d,setFileInput:m,progress:P}),(0,s.jsx)("div",{className:"px-2 sm:px-6 lg:max-w-6xl lg:mx-auto lg:px-8",children:(0,s.jsx)("div",{className:"py-2 md:flex md:items-center md:justify-between lg:border-t lg:border-gray-200",children:(0,s.jsxs)("div",{className:"mt-6 flex space-x-3 md:mt-0 md:ml-4 w-full items-end",children:[(0,s.jsx)(U,{onEmojiSelect:function(e){o((function(t){return t.concat(" ".concat(e.native," "))}))}}),(0,s.jsx)(F.Z,{setFile:m}),(0,s.jsx)("textarea",{name:"name",id:"name",ref:ee,value:l,onKeyPress:function(e){e.shiftKey&&"Enter"===e.key?o("".concat(l)):"Enter"!==e.key||oe()},onChange:function(e){"\n"!==e.target.value&&o(e.target.value)},className:"tracking-wide shadow-sm focus:ring-primary focus:border-primary border-primary border block w-full sm:text-sm border-gray-300 px-4 rounded-md pt-2",placeholder:"Start a new message"}),(0,s.jsx)("button",{type:"button",onClick:function(){return oe()},className:"max-h-10 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500",children:"Send"})]})})})]})},$=function(e){var t=e.activeConversation,n=(0,i.useState)([]),a=n[0],r=n[1],l=(0,p.ff)().data,o=(0,y.LU)().data,c=A((0,k.KO)(C.Lu),2),d=c[0],m=c[1],f=A((0,k.KO)(S._B),1)[0],x=(0,i.useRef)(null);(0,i.useEffect)((function(){var e;null===(e=x.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})),(0,i.useEffect)((function(){t?(r(t.messages),m((0,b.MQ)(d,t.messages))):r([])}),[d,m,t]);var v=function(e){if("https://didcomm.org/webrtc/1.0/sdp"===e.data.type)return"offer"===e.data.body.content.signal.type?(0,s.jsxs)("p",{children:["Sent an invitiation to connect."," ",(0,b.qP)(e.data.created_time)&&(0,N.Ho)(e.data.from)!==o.id&&(0,s.jsx)("a",{className:"font-bold underline",onClick:function(){return(0,w.WV)({detail:{message:e.data.body.content,knownContact:(0,K.Er)({shortFormDid:(0,N.Ho)(e.data.from),contacts:l.data.contacts}),sourceType:"didcomm"}})},children:"Show"})]}):"Sent you an invite to connect.";if("file-transfer-done"===e.data.type)return e.data.body.content.image?(0,s.jsx)("img",{src:e.data.body.content.image,alt:"",width:500,height:500}):(0,s.jsx)(P.Z,{message:{data:e.data.body.content,from:(0,N.Ho)(e.data.from)},myDid:o.id});var t=e.data.body.content;if(L(t)){var n=JSON.parse(t),a=n.data.name,i=n.dataUri;if(a&&I()().test(i)){var r=atob(i.split(",")[1]),c=i.split(",")[0].split(":")[1].split(";")[0];if("image"===c.split("/")[0])return(0,s.jsx)("img",{src:i,alt:"",width:500,height:500});for(var d=new Uint8Array(r.length),m=0;m<r.length;m++)d[m]=r.charCodeAt(m);var u=new File([d],a,{type:c});return(0,s.jsx)(P.Z,{message:{data:{name:a,type:c,size:u.size,id:null},from:e.data.from},fileObj:u,myDid:o.id})}return t}return t};return(0,s.jsxs)("div",{className:"flex flex-col w-full h-full pt-6 overflow-y-auto",children:[a.map((function(e,t){return(0,s.jsx)("div",{className:"flex py-1 ".concat((0,N.Ho)(e.data.from)===o.id?"pl-4 flex-row-reverse":"pr-4"),children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"px-4 py-2 rounded-lg inline-block rounded-br-none text-sm whitespace-pre-line ".concat((n=(0,N.Ho)(e.data.from),n===o.id?(null===f||void 0===f?void 0:f.peer.connected)?"bg-blue-600 text-white":"bg-secondary text-white":"bg-gray-200 text-gray-800")),children:v(e)}),e.data.body.payment&&(0,s.jsxs)("p",{className:"text-sm inline-flex text-center",children:[(0,N.Ho)(e.data.from)===o.id?"Sent":"Received",": +",parseInt(e.data.body.payment).toLocaleString()," sats"," ",(0,s.jsx)(u.mly,{className:"w-3 h-3 mt-1.5 ml-0.5"})]}),(0,s.jsx)("div",{className:"flex ".concat((0,N.Ho)(e.data.from)===o.id&&"flex-row-reverse"),children:(0,s.jsx)("p",{className:"text-primary opacity-30 text-xs",children:g().unix(e.data.created_time).fromNow()})})]})},t);var n})),(0,s.jsx)("div",{ref:x})]})},Q=function(e){var t=e.openContactPreview,n=e.setOpenContactPreview,a=e.currentConversationContact;return(0,s.jsx)(r.uT.Root,{show:t,as:i.Fragment,children:(0,s.jsx)(r.Vq,{as:"div",className:"fixed inset-0 overflow-hidden z-10",onClose:n,children:(0,s.jsxs)("div",{className:"absolute inset-0 overflow-hidden",children:[(0,s.jsx)(r.Vq.Overlay,{className:"absolute inset-0"}),(0,s.jsx)("div",{className:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10",children:(0,s.jsx)(r.uT.Child,{as:i.Fragment,enter:"transform transition ease-in-out duration-500 sm:duration-700",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transform transition ease-in-out duration-500 sm:duration-700",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:(0,s.jsx)("div",{className:"pointer-events-auto w-screen max-w-md",children:(0,s.jsxs)("div",{className:"flex h-full flex-col overflow-y-scroll bg-white py-6 shadow-xl",children:[(0,s.jsx)("div",{className:"px-4 sm:px-6",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)(r.Vq.Title,{className:"text-lg font-medium text-gray-900",children:[" ","Contact"," "]}),(0,s.jsx)("div",{className:"ml-3 flex h-7 items-center",children:(0,s.jsxs)("button",{type:"button",className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:function(){return n(!1)},children:[(0,s.jsx)("span",{className:"sr-only",children:"Close panel"}),(0,s.jsx)(m.Z,{className:"h-6 w-6","aria-hidden":"true"})]})})]})}),(0,s.jsx)("div",{className:"relative mt-6 flex-1 px-4 sm:px-6",children:(0,s.jsx)(x.ContactView,{selectedContact:a})})]})})})})]})})})};function W(){var e=(0,i.useState)(!1),t=e[0],n=e[1],r=(0,i.useState)(!1),l=r[0],o=r[1],c=(0,i.useState)(!1),d=c[0],m=c[1],u=(0,i.useState)(),x=u[0],v=u[1],g=A((0,k.KO)(C.D0),2),b=g[0],N=g[1],E=A((0,k.KO)(C.w5),2),F=E[0],Z=E[1],z=A((0,k.KO)(S.fo),2)[1],I=A((0,k.KO)(C.r2),1)[0],P=(0,p.ff)().data,D=(0,y.LU)().data,_=(0,j.mA)({myDid:D,contacts:null===P||void 0===P?void 0:P.data.contacts}).data,T=(0,j.$3)().mutate;(0,i.useEffect)((function(){if(b){var e=null===_||void 0===_?void 0:_.conversations.find((function(e){return e.groupId===b}));if(e){var t=(0,K.Lz)({message:e.messages[0],contacts:null===P||void 0===P?void 0:P.data.contacts,myDid:D});v(e),Z(t[0])}}}),[null===P||void 0===P?void 0:P.data.contacts,b,null===_||void 0===_?void 0:_.conversations,D,Z]),(0,i.useEffect)((function(){if(F){var e=null===_||void 0===_?void 0:_.conversations.find((function(e){return e.messages.find((function(e){return e.recipients.includes(F.did)}))}));e?v(e):(v(),N())}}),[b,Z,null===P||void 0===P?void 0:P.data.contacts,D,_,F,N]);return(0,s.jsxs)(a.Z,{currentPage:"Messaging",children:[(0,s.jsx)(h.Z,{open:l,setOpen:o,selectedContact:F||null}),(0,s.jsx)("div",{className:"z-20",children:(0,s.jsx)(Q,{openContactPreview:t,setOpenContactPreview:n,currentConversationContact:F})}),(0,s.jsxs)("div",{className:"flex-1 relative z-0 flex overflow-hidden h-full lg:pr-96 lg:mr-16",children:[(0,s.jsx)("main",{className:"flex-1 relative z-0 overflow-y-auto focus:outline-none xl:order-last bg-white border-r",children:(b||F)&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsx)("div",{className:"flex-none",children:(0,s.jsx)(J,{setOpenContactPreview:n,setOpenPayment:o,sendInvite:function(){var e=(0,O.Z)(),t=(0,w.aH)({networkId:e,networkOwner:D.id,sendBasicMessage:T,lightningEnabled:I,src:D.id,contact:F,type:"live-messaging-invitation",localStream:!1});f.Am.success("Invite Sent"),z(t)},activeConversation:x})}),(0,s.jsx)("div",{className:"grow flex-1 pl-8 pr-4 overflow-hidden",children:(0,s.jsx)($,{activeConversation:x})}),(0,s.jsx)("div",{className:"flex-none",children:(0,s.jsx)(X,{sendBasicMessage:T,myDid:D})})]})})}),(0,s.jsxs)("aside",{className:"hidden relative xl:order-first xl:flex xl:flex-col flex-shrink-0 w-96 border-r border-gray-200 overflow-y-auto",children:[(0,s.jsx)(q,{setToggleNewContact:m,toggleNewContact:d}),d?(0,s.jsx)(G,{setToggleNewContact:m,setCurrentConversationContact:Z}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(H,{}),(0,s.jsx)(V,{})]})]})]})]})}}},function(e){e.O(0,[774,270,445,13,614,967,240,426,267,888,179],(function(){return t=72848,e(e.s=t);var t}));var t=e.O();_N_E=t}]);