(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[27],{25701:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/d/files/[id]",function(){return n(79822)}])},7135:function(e,t,n){"use strict";n.d(t,{BR:function(){return u},kR:function(){return i}});var r=n(88767),o=n(40782),a=n(40874),u=function(e,t){return(0,r.useQuery)("fetch-files",a.uB,{onSuccess:function(t){e(t)},onError:function(e){o.Am.error("Unable to fetch files. Please try again."),console.log("Unable to fetch files. Error: ",e),t()}})},i=function(e,t){var n=(0,r.useQueryClient)();return(0,r.useMutation)(a.cT,{onSuccess:function(){e(),n.invalidateQueries("fetch-files")},onError:function(e){console.log("Error uploading file: ",e),t()}})}},79822:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var r=n(35666),o=n.n(r),a=n(85893),u=n(67294),i=n(11240),c=n(11163),s=n(40782),l=n(30653),f=n(93162),d=n(7135),p=n(40874);function v(e,t,n,r,o,a,u){try{var i=e[a](u),c=i.value}catch(s){return void n(s)}i.done?t(c):Promise.resolve(c).then(r,o)}function h(){var e=(0,c.useRouter)(),t=(0,u.useRef)(),n=(0,u.useState)(),r=n[0],h=n[1],w=(0,u.useState)(),y=w[0],m=w[1],x=(0,u.useState)(),b=x[0],g=x[1],E=(0,u.useState)(!1),P=E[0],k=E[1],_=e.query.id,A=(0,d.BR)((function(e){var t,n=null===e||void 0===e?void 0:e.data.files.find((function(e){return e.split("/")[2]===_}));n&&(n=n.split("/")[2],(0,p._t)(n).then((t=o().mark((function e(t){var r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=atob(t.data.data),e.next=3,(0,p.oy)(r,n);case 3:a=e.sent,console.log(a),a&&h(a);case 6:case"end":return e.stop()}}),e)})),function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function u(e){v(a,r,o,u,i,"next",e)}function i(e){v(a,r,o,u,i,"throw",e)}u(void 0)}))})))})).data,R=(0,u.useCallback)((function(e){var n=URL.createObjectURL(e);t.current.src=n,t.current.play()}),[]),T=(0,u.useCallback)((function(e){var t=new FileReader;t.readAsText(e),t.onloadend=function(){m(t.result)}}),[]),C=(0,u.useCallback)((function(e){var t=new FileReader;t.readAsText(e),t.onloadend=function(){g(t.result)}}),[]);return(0,u.useEffect)((function(){if(_&&A&&r){if(/video\/*/.test(r.type))return void R(r);"text/html"===r.type?T(r):"text/plain"===r.type?C(r):(k(!0),s.Am.error("Unable to process file type. Type is currently unsupported"))}}),[_,R,A,T,C,r]),(0,a.jsxs)(i.Z,{currentPage:"Files",hideNav:!1,children:[r&&(0,a.jsx)("button",{onClick:function(){return(0,f.saveAs)(r)},children:"Download"}),(0,a.jsx)("video",{ref:t,loop:!0}),y&&(0,a.jsx)("div",{children:(0,l.ZP)(y.replace("<!DOCTYPE html><html>","").replace("</html>",""))}),b&&(0,a.jsx)("div",{children:b}),P&&r&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("p",{children:"Unable to render this file for viewing. Would you like to download it instead and view locally?"})})]})}},40874:function(e,t,n){"use strict";n.d(t,{uB:function(){return l},cT:function(){return f},_t:function(){return d},oy:function(){return p}});var r=n(35666),o=n.n(r),a=n(49695),u=n(21245),i=n(48764).Buffer;function c(e,t,n,r,o,a,u){try{var i=e[a](u),c=i.value}catch(s){return void n(s)}i.done?t(c):Promise.resolve(c).then(r,o)}var s,l=function(){return(0,a.W)({url:"/v1/ipfs/list",method:"get",headers:{"Grpc-Metadata-X-API-KEY":"".concat(localStorage.getItem("apiKey"))}})},f=function(e){var t=new window.FileReader;t.readAsArrayBuffer(e),t.onloadend=function(){var n=btoa(i(t.result)),r={name:e.name,data:n,updatable:!1};return(0,a.W)({url:"/v1/ipfs/add",method:"post",data:r,headers:{"Grpc-Metadata-X-API-KEY":"".concat(localStorage.getItem("apiKey"))}})}},d=function(e){return(0,a.W)({url:"/v1/ipfs/".concat(e),method:"get",headers:{"Grpc-Metadata-X-API-KEY":"".concat(localStorage.getItem("apiKey"))}})},p=(s=o().mark((function e(t,n){var r,a,i,c,s,l,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.substring(0,20).includes("<!DOCTYPE html>")){e.next=3;break}return r=new File([t],n,{type:"text/html"}),e.abrupt("return",r);case 3:for(a=t.split(","),i=new Uint8Array(a.length),c=0;c<a.length;c++)i[c]=a[c];return e.next=8,(0,u.pM)(i);case 8:if(!(s=e.sent)){e.next=13;break}return console.log("FILETYPE: ",s),l=new File([i],n,{type:s?s.mime:""}),e.abrupt("return",l);case 13:return f=new File([t],n,{type:"text/plain"}),e.abrupt("return",f);case 15:case"end":return e.stop()}}),e)})),function(){var e=this,t=arguments;return new Promise((function(n,r){var o=s.apply(e,t);function a(e){c(o,n,r,a,u,"next",e)}function u(e){c(o,n,r,a,u,"throw",e)}a(void 0)}))})},50247:function(){}},function(e){e.O(0,[384,245,653,240,774,888,179],(function(){return t=25701,e(e.s=t);var t}));var t=e.O();_N_E=t}]);