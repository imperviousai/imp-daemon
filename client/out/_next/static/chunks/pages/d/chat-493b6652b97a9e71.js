(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[843],{72848:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/d/chat",function(){return t(41436)}])},51079:function(e,n,t){"use strict";var s=t(85893),r=t(67294),i=t(42633),a=(t(40782),t(25934));function l(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.Z=function(e){var n=e.setFile,t=e.disabled,o=(0,r.useRef)(null);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{type:"button",onClick:function(e){o.current.click()},children:(0,s.jsx)(i.Z,{className:"h-10 w-10 text-gray-600 font-light","aria-hidden":"true"})}),(0,s.jsx)("input",{type:"file",ref:o,onChange:function(e){var t=e.target.files[0];n((function(e){return l(e).concat([{file:t,isError:!1,isUploading:!1,id:(0,a.Z)()}])})),o.current.value=null},style:{display:"none"},disabled:t})]})}},45192:function(e,n,t){"use strict";var s=t(85893),r=(t(67294),t(68163)),i=t(86588),a=t(13902),l=t(40782);n.Z=function(e){var n=e.fileInput,t=e.setFileInput,o=function(e){t((function(n){return n.filter((function(n){return n.id!==e}))}))},c=function(e){return e.isUploading?(0,s.jsx)(i.gy,{height:"20",width:"20",color:"#312e81",ariaLabel:"loading"}):e.isError?(0,s.jsx)(a.Z,{onClick:function(){l.Am.error("Unable to upload file. Please try again."),o(e.id)},className:"h-6 w-6 text-red-600","aria-hidden":"true"}):(0,s.jsxs)("button",{type:"button",className:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:function(){return o(f.id)},children:[(0,s.jsx)("span",{className:"sr-only",children:"Close"}),(0,s.jsx)(r.Z,{className:"h-5 w-5","aria-hidden":"true"})]})};return(0,s.jsx)(s.Fragment,{children:n.map((function(e,n){return(0,s.jsxs)("div",{children:[" ",(0,s.jsx)("div",{className:"my-3 max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden",children:(0,s.jsx)("div",{className:"p-4",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-0 flex-1 flex justify-between",children:(0,s.jsxs)("p",{className:"w-0 flex-1 text-sm font-medium text-gray-900",children:[e.file.name," ",(0,s.jsxs)("span",{className:"font-light text-gray-500",children:["(",e.file.size," bytes)"]})]})}),(0,s.jsx)("div",{className:"ml-4 flex-shrink-0 flex",children:c(e)})]})})})]},n)}))})}},59758:function(e,n,t){"use strict";var s=t(85893),r=(t(67294),t(42833)),i=t(63090),a=t(93162);n.Z=function(e){var n=e.message,t=e.myDid,l=e.fileObj;return(0,s.jsx)("div",{className:"bg-white px-4 py-5 border-2 border-gray-200 rounded-lg sm:px-6 mt-6",children:(0,s.jsxs)("div",{className:"-ml-4 -mt-4 flex justify-between items-center flex-wrap sm:flex-nowrap",children:[(0,s.jsx)("div",{className:"ml-4 mt-4",children:(0,s.jsx)("div",{className:"flex space-x-2 items-center",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("h3",{className:"text-md leading-6 break-all font-medium text-gray-900",children:n.data?n.data.name:"No File Name"}),(0,s.jsx)("p",{className:"mt-1 text-sm font-light text-gray-500",children:n.data&&"(".concat(n.data.size," bytes)")})]})})}),(0,s.jsx)("div",{className:"ml-4 mt-4 flex-shrink-0",children:n.from!==t&&(0,s.jsx)("button",{type:"button",onClick:function(){return function(){var e=n.data,t=e.id,s=e.name,r=e.type;l?(0,a.saveAs)(l,s):(0,i.X$)("file-download-request",{id:t,name:s,type:r})}()},className:"relative inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-gray-500 hover:text-black",children:(0,s.jsx)(r.Z,{className:"h-6 w-6","aria-hidden":"true"})})})]})})}},49332:function(e,n,t){"use strict";var s=t(67294);n.Z=function(e,n){(0,s.useEffect)((function(){if(e){e.style.height="40px",e.style.minHeight="40px";var n=e.scrollHeight;e.style.height=n+"px"}}),[e,n])}},41436:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return W}});var s=t(85893),r=t(13471),i=t(67294),a=t(56727),l=t(13342),o=t(94323),c=t(57556),d=t(37051),m=t(5506),u=t(6828),f=t(63750),x=t(40782),g=t(85115),h=(t(74855),t(30381)),v=t.n(h),p=t(18426),y=t(6218),b=t(46249),j=t(61751),w=t(24796),N=t(37328),C=t(59856),k=t(43101),O=t(91131),S=t(25934),F=t(82130),P=t(5152),Z=t(51079),E=t(45192),D=t(82628),z=t.n(D),A=t(88247),I=t(59758),T=t(49332);function _(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function M(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},s=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),s.forEach((function(n){_(e,n,t[n])}))}return e}function K(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=[],s=!0,r=!1,i=void 0;try{for(var a,l=e[Symbol.iterator]();!(s=(a=l.next()).done)&&(t.push(a.value),!n||t.length!==n);s=!0);}catch(o){r=!0,i=o}finally{try{s||null==l.return||l.return()}finally{if(r)throw i}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var U=function(e){try{JSON.parse(e)}catch(n){return!1}return!0},B=(0,P.default)((function(){return Promise.all([t.e(314),t.e(787),t.e(420)]).then(t.bind(t,52843))}),{loadableGenerated:{webpack:function(){return[52843]},modules:["d/chat.jsx -> ../../components/EmojiPicker"]},ssr:!1});function L(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.filter(Boolean).join(" ")}var R=function(){var e=[{name:"Messages",href:"#",current:!0}];return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"sm:hidden",children:[(0,s.jsx)("label",{htmlFor:"tabs",className:"sr-only",children:"Select a tab"}),(0,s.jsx)("select",{id:"tabs",name:"tabs",className:"block w-full focus:ring-indigo-500 focus:border-indigo-500 border-gray-300",defaultValue:e.find((function(e){return e.current})).name,children:e.map((function(e){return(0,s.jsx)("option",{children:e.name},e.name)}))})]}),(0,s.jsx)("div",{className:"hidden sm:block",children:(0,s.jsx)("nav",{className:"relative z-0 shadow flex divide-x divide-gray-200","aria-label":"Tabs",children:e.map((function(e,n){return(0,s.jsxs)("a",{href:e.href,className:L(e.current?"text-gray-900":"text-gray-500 hover:text-gray-700","group relative min-w-0 flex-1 overflow-hidden bg-white py-4 px-4 text-sm font-medium text-center hover:bg-gray-50 focus:z-10"),"aria-current":e.current?"page":void 0,children:[(0,s.jsx)("span",{children:e.name}),(0,s.jsx)("span",{"aria-hidden":"true",className:L(e.current?"bg-indigo-500":"bg-transparent","absolute inset-x-0 bottom-0 h-0.5")})]},e.name)}))})})]})},V=function(e){var n=e.metadata,t=e.unreadMessages,r=e.contact;return(0,s.jsxs)("div",{className:"flex items-center justify-between space-x-4",children:[(0,s.jsxs)("div",{className:"flex space-x-4",children:[r&&(0,s.jsx)(u.nQ,M({className:"h-10 w-10"},(0,w.rH)(r))),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("p",{className:"".concat(t>0?"font-bold":"font-light"," text-md"),children:n.name}),(0,s.jsx)("p",{className:"".concat(t?"font-bold":"font-light"," text-sm"),children:function(){var e,t,r;if("https://didcomm.org/webrtc/1.0/sdp"===(null===(e=n.lastMessage)||void 0===e?void 0:e.type)){if("offer"===n.lastMessage.body.content.signal.type)return(0,s.jsx)("p",{children:"Sent an invite to connect"})}else{if("file-transfer-done"===(null===(t=n.lastMessage)||void 0===t?void 0:t.type))return"File sent.";var i,a;if(!U(null===(r=n.lastMessage)||void 0===r?void 0:r.body.content))return"".concat(null===(a=null===(i=n.lastMessage)||void 0===i?void 0:i.body.content)||void 0===a?void 0:a.slice(0,20));var l,o=JSON.parse(null===(l=n.lastMessage)||void 0===l?void 0:l.body.content),c=o.filename,d=o.dataUri;if(c&&d)return"File sent."}}()})]})]}),(0,s.jsx)("div",{className:"flex flex-col pb-4",children:(0,s.jsx)("p",{className:"text-sm font-light",children:v().unix(n.lastUpdated).fromNow()})})]})},H=function(e){var n=e.conversations,t=e.selectConversation,r=e.contacts,a=(0,i.useState)({}),l=a[0],o=a[1],c=K((0,O.KO)(k.Lu),1)[0];return(0,i.useEffect)((function(){var e={};n&&Object.keys(n).map((function(t,s){var r=n[t].messages.filter((function(e){return-1===c.indexOf(e.id)})).length;e[t]=r})),o(e)}),[n,c]),(0,s.jsxs)("div",{className:"bg-white lg:min-w-0 lg:flex-1",children:[(0,s.jsx)("div",{className:"pl-4 pr-6 py-2 border-b border-t border-gray-200 sm:pl-6 lg:pl-8 xl:pl-6 xl:border-t-0",children:(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)("h1",{className:"flex-1 text-md font-medium",children:"Messages"})})}),(0,s.jsx)("ul",{role:"list",className:"relative z-0 divide-y divide-gray-200 border-b border-gray-200",children:n&&Object.keys(n).map((function(e,i){return(0,s.jsx)("li",{className:"relative pl-4 pr-6 py-5 hover:bg-gray-50 sm:py-3 sm:pl-6 lg:pl-8 xl:pl-6 blue=",onClick:function(){return t(e)},children:(0,s.jsx)(V,{metadata:n[e].metadata,unreadMessages:l[e],contact:r.find((function(n){return n.did===e}))})},i)}))})]})},q=function(e){var n=e.setOpenContactPreview,t=e.setOpenPayment,r=e.deleteConversation,o=e.sendInvite,d=K((0,O.KO)(F._B),1)[0],m=K((0,O.KO)(k.D0),1)[0];return(0,s.jsx)("div",{className:"bg-white shadow",children:(0,s.jsx)("div",{className:"px-4 sm:px-6 lg:max-w-6xl lg:mx-auto lg:px-8",children:(0,s.jsxs)("div",{className:"py-2 md:flex md:items-center md:justify-between lg:border-t lg:border-gray-200",children:[(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"flex items-center",onClick:function(){return n(!0)},children:[(0,s.jsx)(u.nQ,M({},(0,w.rH)(m),{className:"w-10 h-10"})),(0,s.jsx)("div",{className:"flex flex-col ml-3",children:(0,s.jsxs)("h1",{className:"text-lg font-semibold leading-7 text-gray-900 sm:leading-9 sm:truncate",children:[m.name," "]})})]})})})}),(0,s.jsxs)("div",{className:"mt-6 flex space-x-3 md:mt-0 md:ml-4 space-x-4",children:[(null===d||void 0===d?void 0:d.peer)&&(0,s.jsx)(s.Fragment,{children:(null===d||void 0===d?void 0:d.peer.connected)?(0,s.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-medium text-blue-400",children:"Connected"}):(0,s.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-medium text-gray-400",children:"Connecting ..."})}),(null===d||void 0===d?void 0:d.peer)?(0,s.jsx)("div",{className:"flex space-x-4",children:(0,s.jsxs)("button",{type:"button",onClick:function(){d.peer.destroy()},className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500",children:[(0,s.jsx)(c.Z,{className:"-ml-0.5 mr-2 h-4 w-4","aria-hidden":"true"}),(null===d||void 0===d?void 0:d.peer.connected)?"Disconnect":"Cancel"]})}):(0,s.jsxs)("button",{type:"button",onClick:function(){return o()},className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-400 hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,s.jsx)(c.Z,{className:"-ml-0.5 mr-2 h-4 w-4","aria-hidden":"true"}),"Connect"]}),(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)("button",{type:"button",onClick:function(){return t(!0)},className:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[(0,s.jsx)(f.mly,{className:"-ml-0.5 mr-2 h-4 w-4","aria-hidden":"true"}),"Send"]})}),(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)(a.v2,{as:"div",className:"relative inline-block text-left",children:[(0,s.jsx)("div",{children:(0,s.jsxs)(a.v2.Button,{className:"flex items-center text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-indigo-500",children:[(0,s.jsx)("span",{className:"sr-only",children:"Open options"}),(0,s.jsx)(l.Z,{className:"h-8 w-8","aria-hidden":"true"})]})}),(0,s.jsx)(a.uT,{as:i.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,s.jsx)(a.v2.Items,{className:"origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-50",children:(0,s.jsx)("div",{className:"py-1",children:(0,s.jsx)(a.v2.Item,{children:function(e){var n=e.active;return(0,s.jsx)("a",{onClick:function(){return r()},className:L(n?"bg-gray-100 text-red-900":"text-red-700","block px-4 py-2 text-sm"),children:"Delete"})}})})})})]})})]})]})})})},J=function(e){var n=e.setToggleNewContact,t=e.toggleNewContact;return(0,s.jsx)("div",{className:"bg-white shadow",children:(0,s.jsx)("div",{className:"px-4 sm:px-6 py-2 lg:max-w-6xl lg:mx-auto lg:px-8 flex justify-end",children:(0,s.jsx)("button",{type:"button",onClick:function(){return n(!t)},className:"inline-flex items-center px-3 py-2 my-2 border border-transparent text-sm leading-4 font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:t?(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(o.Z,{className:"w-4 h-4"}),"Back"]}):(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(d.Z,{className:"w-4 h-4"}),"New Message"]})})})})},Q=function(e){var n=e.contacts,t=e.setToggleNewContact,r=e.selectConversation;return(0,s.jsxs)("div",{className:"bg-white lg:min-w-0 lg:flex-1",children:[(0,s.jsx)("div",{className:"pl-4 pr-6 py-4 border-b flex items-center justify-center border-primary sm:pl-6 lg:pl-8 xl:pl-6",children:(0,s.jsx)("h4",{className:"font-semibold text-sm",children:"Select a Contact"})}),(0,s.jsx)("ul",{role:"list",className:"relative z-0 divide-y divide-gray-200 border-b border-gray-200",children:n.map((function(e,n){return(0,s.jsx)("li",{onClick:function(){r(e.did),t(!1)},className:"relative pl-4 pr-6 py-5 hover:bg-gray-50 sm:py-3 sm:pl-6 lg:pl-8 xl:pl-6 blue=",children:(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)(u.nQ,M({className:"h-10 w-10"},(0,w.rH)(e))),(0,s.jsx)("div",{className:"flex flex-col justify-center",children:(0,s.jsx)("p",{className:"font-base",children:e.name})})]})})},n)}))})]})},X=function(e){var n=e.sendBasicMessage,t=e.myDid,r=(0,i.useState)(""),a=r[0],l=r[1],o=K((0,O.KO)(k.r2),1)[0],c=K((0,O.KO)(F._B),1)[0],d=K((0,O.KO)(k.D0),1)[0],m=K((0,O.KO)(F.Uy),1)[0],u=(0,j.de)().mutate,f=(0,i.useRef)(null);(0,T.Z)(f.current,a);var g=(0,i.useState)([]),h=g[0],v=g[1],p=function(){x.Am.error("Error sending message. Please try again.")},y=function(e){n({msg:e||a,did:d.did,type:"https://didcomm.org/basicmessage/2.0/message",amount:o?50:0,reply_to_id:"",isPayment:!1},{onError:p})},b=function(e,n){var s=c.metadata.networkId!==m?c.metadata.networkId:null,r={timestamp:(new Date).toString(),from:t.id,did:d.did,networkId:s,type:n},i=M("live-message"===n?{msg:e}:{data:e},r);c.peer.write(JSON.stringify(i))},w=function(e,n){v((function(t){return t.map((function(t){return t.id===e?M({},t,{isUploading:n}):t}))}))},N=function(e){v((function(n){return n.filter((function(n){return n.id!==e}))}))},C=function(e){var n=e.file,s=n.name,r=n.type;console.log("Sending file: ",s),w(e.id,!0),e.file.arrayBuffer().then((function(n){for(;n.byteLength;){var i=n.slice(0,16384);n=n.slice(16384,n.byteLength);var a=(0,A.c)(i);b({name:s,type:r,id:e.id,data:a},"file-transfer-chunk")}!function(e){console.log("File transfer is complete: ",e);var n=e.file,s=n.name,r=n.type,i=n.size,a=e.id;if(b({name:s,type:r,size:i,id:a},"file-transfer-done"),"image"===r.split("/")[0]){var l=new FileReader;l.readAsDataURL(e.file),l.onloadend=function(){u({msg:{name:s,type:r,size:i,id:a,image:l.result},type:"file-transfer-done",from:t.id,did:d.did})}}else u({msg:{name:s,type:r,size:i,id:a,image:""},type:"file-transfer-done",from:t.id,did:d.did});w(e.id,!1),N(e.id)}(e)}))},S=function(){if(h&&h.forEach((function(e){if(!c&&e.file.size>2e6)x.Am.error("File size is too large to send. (Max 2MB). Please connect with user to send larger files.");else{if(c)return void C(e);var n=new FileReader;n.readAsDataURL(e.file),n.onloadend=function(){y(JSON.stringify({data:{name:e.file.name},dataUri:n.result})),N(e.id)}}})),a.length>0&&d){if(c)return b(a,"live-message"),u({msg:a,type:"live-message",from:t.id,did:d.did}),void l("");y()}l("")};return(0,s.jsxs)("div",{className:"bg-white shadow",children:[(0,s.jsx)(E.Z,{fileInput:h,setFileInput:v}),(0,s.jsx)("div",{className:"px-4 sm:px-6 lg:max-w-6xl lg:mx-auto lg:px-8",children:(0,s.jsx)("div",{className:"py-2 md:flex md:items-center md:justify-between lg:border-t lg:border-gray-200",children:(0,s.jsxs)("div",{className:"mt-6 flex space-x-3 md:mt-0 md:ml-4 w-full items-end",children:[(0,s.jsx)(B,{onEmojiSelect:function(e){l((function(n){return n.concat(" ".concat(e.native," "))}))}}),(0,s.jsx)(Z.Z,{setFile:v}),(0,s.jsx)("textarea",{name:"name",id:"name",ref:f,value:a,onKeyPress:function(e){e.shiftKey&&"Enter"===e.key?l("".concat(a)):"Enter"!==e.key||S()},onChange:function(e){"\n"!==e.target.value&&l(e.target.value)},className:"tracking-wide shadow-sm focus:ring-primary focus:border-primary border-primary border block w-full sm:text-sm border-gray-300 px-4 rounded-md pt-2",placeholder:"Start a new message"}),(0,s.jsx)("button",{type:"button",onClick:function(){return S()},className:"max-h-10 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500",children:"Send"})]})})})]})},$=function(e){var n=e.messages,t=e.myDid,r=(0,i.useState)([]),a=r[0],l=r[1],o=(0,y.ff)().data,c=K((0,O.KO)(k.Lu),2),d=c[0],m=c[1],u=K((0,O.KO)(k.D0),1)[0],x=K((0,O.KO)(F._B),1)[0],g=(0,i.useRef)(null);(0,i.useEffect)((function(){var e;null===(e=g.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})),(0,i.useEffect)((function(){if((null===n||void 0===n?void 0:n.conversations)&&u){var e,t=null===(e=null===n||void 0===n?void 0:n.conversations[u.did])||void 0===e?void 0:e.messages;t?(l(t),m((0,N.MQ)(d,t))):l([])}}),[n,u,d,m]);var h=function(e){if("https://didcomm.org/webrtc/1.0/sdp"===e.data.type){var n=null===o||void 0===o?void 0:o.data.contacts.find((function(n){return n.did===e.data.from}));return"offer"===e.data.body.content.signal.type?(0,s.jsxs)("p",{children:["Sent an invitiation to connect."," ",(0,N.qP)(e.data.created_time)&&e.data.from!==t.id&&(0,s.jsx)("a",{className:"font-bold underline",onClick:function(){return(0,C.WV)({detail:{message:e.data.body.content,knownContact:n||null,sourceType:"didcomm"}})},children:"Show"})]}):"Sent you an invite to connect."}if("file-transfer-done"===e.data.type)return e.data.body.content.image?(0,s.jsx)("img",{src:e.data.body.content.image,alt:"",width:500,height:500}):(0,s.jsx)(I.Z,{message:{data:e.data.body.content,from:e.data.from},myDid:t.id});var r=e.data.body.content;if(U(r)){var i=JSON.parse(r),a=i.data.name,l=i.dataUri;if(a&&z()().test(l)){var c=atob(l.split(",")[1]),d=l.split(",")[0].split(":")[1].split(";")[0];if("image"===d.split("/")[0])return(0,s.jsx)("img",{src:l,alt:"",width:500,height:500});for(var m=new Uint8Array(c.length),u=0;u<c.length;u++)m[u]=c.charCodeAt(u);var f=new File([m],a,{type:d});return(0,s.jsx)(I.Z,{message:{data:{name:a,type:d,size:f.size,id:null},from:e.data.from},fileObj:f,myDid:t.id})}return r}return r};return(0,s.jsxs)("div",{className:"flex flex-col w-full h-full pt-6 overflow-y-auto",children:[a.map((function(e,n){return(0,s.jsx)("div",{className:"flex py-1 ".concat(e.data.from===t.id?"pl-4 flex-row-reverse":"pr-4"),children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"px-4 py-2 rounded-lg inline-block rounded-br-none text-sm whitespace-pre-line ".concat((r=e.data.from,r===t.id?(null===x||void 0===x?void 0:x.peer.connected)?"bg-blue-600 text-white":"bg-secondary text-white":"bg-gray-200 text-gray-800")),children:h(e)}),e.data.body.payment&&(0,s.jsxs)("p",{className:"text-sm inline-flex text-center",children:[e.data.from===t.id?"Sent":"Received",": +",parseInt(e.data.body.payment).toLocaleString()," sats"," ",(0,s.jsx)(f.mly,{className:"w-3 h-3 mt-1.5 ml-0.5"})]}),(0,s.jsx)("div",{className:"flex ".concat(e.data.from===t.id&&"flex-row-reverse"),children:(0,s.jsx)("p",{className:"text-primary opacity-30 text-xs",children:v().unix(e.data.created_time).fromNow()})})]})},n);var r})),(0,s.jsx)("div",{ref:g})]})},G=function(e){var n=e.openContactPreview,t=e.setOpenContactPreview,r=e.currentConversation;return(0,s.jsx)(a.uT.Root,{show:n,as:i.Fragment,children:(0,s.jsx)(a.Vq,{as:"div",className:"fixed inset-0 overflow-hidden z-30",onClose:t,children:(0,s.jsxs)("div",{className:"absolute inset-0 overflow-hidden",children:[(0,s.jsx)(a.Vq.Overlay,{className:"absolute inset-0"}),(0,s.jsx)("div",{className:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10",children:(0,s.jsx)(a.uT.Child,{as:i.Fragment,enter:"transform transition ease-in-out duration-500 sm:duration-700",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transform transition ease-in-out duration-500 sm:duration-700",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:(0,s.jsx)("div",{className:"pointer-events-auto w-screen max-w-md",children:(0,s.jsxs)("div",{className:"flex h-full flex-col overflow-y-scroll bg-white py-6 shadow-xl",children:[(0,s.jsx)("div",{className:"px-4 sm:px-6",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)(a.Vq.Title,{className:"text-lg font-medium text-gray-900",children:[" ","Contact"," "]}),(0,s.jsx)("div",{className:"ml-3 flex h-7 items-center",children:(0,s.jsxs)("button",{type:"button",className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:function(){return t(!1)},children:[(0,s.jsx)("span",{className:"sr-only",children:"Close panel"}),(0,s.jsx)(m.Z,{className:"h-6 w-6","aria-hidden":"true"})]})})]})}),(0,s.jsx)("div",{className:"relative mt-6 flex-1 px-4 sm:px-6",children:(0,s.jsx)(g.ContactView,{selectedContact:r})})]})})})})]})})})};function W(){var e=(0,i.useState)(!1),n=e[0],t=e[1],a=(0,i.useState)(!1),l=a[0],o=a[1],c=(0,i.useState)(!1),d=c[0],m=c[1],u=K((0,O.KO)(k.D0),2),f=u[0],g=u[1],h=K((0,O.KO)(F.fo),2)[1],v=K((0,O.KO)(k.r2),1)[0],w=(0,y.ff)().data,N=(0,b.LU)().data,P=(0,j.mA)({myDid:N,contacts:null===w||void 0===w?void 0:w.data.contacts}).data,Z=(0,j.$3)().mutate,E=(0,j.bj)().mutate,D=function(e){var n=null===w||void 0===w?void 0:w.data.contacts.find((function(n){return n.did===e}));g(n)};return(0,s.jsxs)(r.Z,{currentPage:"Messaging",children:[(0,s.jsx)(p.Z,{open:l,setOpen:o,selectedContact:f||null}),(0,s.jsx)("div",{className:"z-20",children:(0,s.jsx)(G,{openContactPreview:n,setOpenContactPreview:t,currentConversation:f})}),(0,s.jsxs)("div",{className:"flex-1 relative z-0 flex overflow-hidden h-full lg:pr-96 lg:mr-16",children:[(0,s.jsx)("main",{className:"flex-1 relative z-0 overflow-y-auto focus:outline-none xl:order-last bg-white border-r",children:f&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsx)("div",{className:"flex-none",children:(0,s.jsx)(q,{setOpenContactPreview:t,setOpenPayment:o,sendInvite:function(){var e=(0,S.Z)(),n=(0,C.aH)({networkId:e,networkOwner:N.id,sendBasicMessage:Z,lightningEnabled:v,src:N.id,contact:f,type:"live-messaging-invitation",localStream:!1});x.Am.success("Invite Sent"),h(n)},deleteConversation:function(){f&&(0,x.Am)((function(e){var n=e.closeToast;return(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"pb-4",children:"Delete this conversation?"}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("button",{type:"button",onClick:function(){var e,t=null===(e=P.conversations[f.did])||void 0===e?void 0:e.metadata.groupId;t&&(E({groupId:t}),g()),n()},className:"inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Delete"}),(0,s.jsx)("button",{type:"button",onClick:n,className:"inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})}),{autoClose:!1})}})}),(0,s.jsx)("div",{className:"grow flex-1 pl-8 pr-4 overflow-hidden",children:(0,s.jsx)($,{messages:P,myDid:N})}),(0,s.jsx)("div",{className:"flex-none",children:(0,s.jsx)(X,{sendBasicMessage:Z,myDid:N})})]})})}),(0,s.jsxs)("aside",{className:"hidden relative xl:order-first xl:flex xl:flex-col flex-shrink-0 w-96 border-r border-gray-200 overflow-y-auto",children:[(0,s.jsx)(J,{setToggleNewContact:m,toggleNewContact:d}),d?(0,s.jsx)(Q,{setToggleNewContact:m,contacts:null===w||void 0===w?void 0:w.data.contacts,selectConversation:D}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(R,{}),(0,s.jsx)(H,{selectConversation:D,myDid:N,conversations:null===P||void 0===P?void 0:P.conversations,contacts:null===w||void 0===w?void 0:w.data.contacts})]})]})]})]})}}},function(e){e.O(0,[774,270,445,13,771,768,471,426,115,888,179],(function(){return n=72848,e(e.s=n);var n}));var n=e.O();_N_E=n}]);